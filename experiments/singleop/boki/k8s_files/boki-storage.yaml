apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: boki-storage
  labels:
    app: boki-storage
spec:
  selector:
    matchLabels:
      app: boki-storage
  template:
    metadata:
      labels:
        app: boki-storage
    spec:
      containers:
      - name: boki-storage
        image: shengqipku/halfmoon:sosp-ae
        command: ["/boki/storage"]
        args:
          - --zookeeper_host=10.244.0.3:2181
          - --listen_iface=eth0
          - --db_path=/tmp/storage/logdata
          - --num_io_workers=2
          - --io_uring_entries=2048
          - --io_uring_fd_slots=4096
          - --slog_local_cut_interval_us=300
          - --slog_storage_bgthread_interval_ms=1
          - --slog_storage_backend=rocksdb
          - --slog_storage_cache_cap_mb=4096
          # - --use_txn_engine
          # - --v=1
        volumeMounts:
          - name: storage-volume
            mountPath: /tmp/storage
        env:
          - name: FAAS_NODE_ID
            value: "1"
      volumes:
        - name: storage-volume
          hostPath:
            path: /mnt/storage
      nodeSelector:
        node-restriction.kubernetes.io/placement_label: engine_node
      restartPolicy: Always
