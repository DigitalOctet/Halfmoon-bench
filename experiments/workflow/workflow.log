Finish setup in 51.898 seconds
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS800
+ QPS=800
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ MANAGER_HOST=ip-172-31-11-71.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ CLIENT_HOST=ip-172-31-15-205.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-11-71.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ ALL_HOSTS='ip-172-31-6-133.ap-southeast-1.compute.internal
ip-172-31-8-188.ap-southeast-1.compute.internal
ip-172-31-7-85.ap-southeast-1.compute.internal
ip-172-31-15-57.ap-southeast-1.compute.internal
ip-172-31-15-159.ap-southeast-1.compute.internal
ip-172-31-4-164.ap-southeast-1.compute.internal
ip-172-31-2-196.ap-southeast-1.compute.internal
ip-172-31-8-220.ap-southeast-1.compute.internal
ip-172-31-11-71.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/docker-compose.yml 'ip-172-31-11-71.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/docker-compose-generated.yml 'ip-172-31-11-71.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- docker stack rm boki
Nothing found in stack: boki
+ sleep 40
++ tr -dc a-zA-Z0-9
++ fold -w 8
++ head -n 1
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=aYuIuDen
+ TABLE_PREFIX=aYuIuDen-
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
fb0b3276a519: Pulling fs layer
04650d0140a3: Pulling fs layer
2bde0ecdcf0b: Pulling fs layer
631d66a347c9: Pulling fs layer
e3176dba68e3: Pulling fs layer
2c4530d68e03: Pulling fs layer
631d66a347c9: Waiting
e3176dba68e3: Waiting
2c4530d68e03: Waiting
fb0b3276a519: Verifying Checksum
fb0b3276a519: Download complete
2bde0ecdcf0b: Verifying Checksum
2bde0ecdcf0b: Download complete
fb0b3276a519: Pull complete
04650d0140a3: Verifying Checksum
04650d0140a3: Download complete
2c4530d68e03: Verifying Checksum
2c4530d68e03: Download complete
631d66a347c9: Verifying Checksum
631d66a347c9: Download complete
e3176dba68e3: Verifying Checksum
e3176dba68e3: Download complete
04650d0140a3: Pull complete
2bde0ecdcf0b: Pull complete
631d66a347c9: Pull complete
e3176dba68e3: Pull complete
2c4530d68e03: Pull complete
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Downloaded newer image for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bhotel /tmp/
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- TABLE_PREFIX=aYuIuDen- AWS_REGION=ap-southeast-1 /tmp/bhotel/init create baseline
buser status: ACTIVE
bsearch status: ACTIVE
bflight status: ACTIVE
bfrontend status: ACTIVE
bgeo status: ACTIVE
border status: ACTIVE
bhotel status: ACTIVE
bprofile status: ACTIVE
brate status: ACTIVE
brecommendation status: CREATING
brecommendation status: ACTIVE
bgateway status: CREATING
bgateway status: ACTIVE
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- TABLE_PREFIX=aYuIuDen- AWS_REGION=ap-southeast-1 /tmp/bhotel/init populate baseline
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-11-71.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-6-133.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-8-188.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-7-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-15-57.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-15-159.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-4-164.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-2-196.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-8-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-11-71.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-6-133.ap-southeast-1.compute.internal
ip-172-31-8-188.ap-southeast-1.compute.internal
ip-172-31-7-85.ap-southeast-1.compute.internal
ip-172-31-15-57.ap-southeast-1.compute.internal
ip-172-31-15-159.ap-southeast-1.compute.internal
ip-172-31-4-164.ap-southeast-1.compute.internal
ip-172-31-2-196.ap-southeast-1.compute.internal
ip-172-31-8-220.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-6-133.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-8-188.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-7-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-15-57.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-15-159.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-4-164.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-2-196.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-8-220.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- TABLE_PREFIX=aYuIuDen- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-engine
Creating service boki_geo-service
Creating service boki_hotel-service
Creating service boki_profile-service
Creating service boki_recommendation-service
Creating service boki_boki-gateway
Creating service boki_zookeeper
Creating service boki_flight-service
Creating service boki_gateway-service
Creating service boki_rate-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
Creating service boki_frontend-service
Creating service boki_order-service
Creating service boki_search-service
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-6-133.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=501793ee7f95a420bacb1251c774b92cff16b21f2990cc40a6135dc48522adab
+ echo 4096
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/501793ee7f95a420bacb1251c774b92cff16b21f2990cc40a6135dc48522adab/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-8-188.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8f5693bfdf902445ab5be1d7c4f2ca3481dc323a8144df8621632a8965e1f763
+ echo 4096
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8f5693bfdf902445ab5be1d7c4f2ca3481dc323a8144df8621632a8965e1f763/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-7-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=360920eecfc672875f11feeff2c96938c21d18c3c636a8300ef9e089b1eca43f
+ echo 4096
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/360920eecfc672875f11feeff2c96938c21d18c3c636a8300ef9e089b1eca43f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-15-57.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5e6c11de02ce3ef9887d14bb9065fb9f8692bb65b951e2dc6bc3c29ca45fa1a7
+ echo 4096
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5e6c11de02ce3ef9887d14bb9065fb9f8692bb65b951e2dc6bc3c29ca45fa1a7/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-15-159.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=66a2774a4e5b99e1f0108e57911beb10b975d1a3f888ac849c5dbeaca4235268
+ echo 4096
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/66a2774a4e5b99e1f0108e57911beb10b975d1a3f888ac849c5dbeaca4235268/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-4-164.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d604920e39441da229b710c81ab7848c6f92abe0117a6e9bc66b05ae446644f9
+ echo 4096
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d604920e39441da229b710c81ab7848c6f92abe0117a6e9bc66b05ae446644f9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-2-196.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=368e19374b17bf1d66dca06ff070fda2a0b41cc2bed07438ce0fb2d252dd091d
+ echo 4096
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/368e19374b17bf1d66dca06ff070fda2a0b41cc2bed07438ce0fb2d252dd091d/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-8-220.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f846ad8a75e21252ab70b2f5c15652b49239ceb5cd73e89b6e3db3948a0e422f
+ echo 4096
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f846ad8a75e21252ab70b2f5c15652b49239ceb5cd73e89b6e3db3948a0e422f/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS800
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS800
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/hotel/workload.lua ip-172-31-15-205.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-11-71.ap-southeast-1.compute.internal:8080 -R 800
+ sleep 10
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-11-71.ap-southeast-1.compute.internal:8080 -R 800
+ sleep 10
+ scp -q ip-172-31-11-71.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS800
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS800/async_results
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- TABLE_PREFIX=aYuIuDen- AWS_REGION=ap-southeast-1 /tmp/bhotel/init clean baseline
finished QPS800
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS900
+ QPS=900
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ MANAGER_HOST=ip-172-31-11-71.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ CLIENT_HOST=ip-172-31-15-205.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-11-71.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ ALL_HOSTS='ip-172-31-6-133.ap-southeast-1.compute.internal
ip-172-31-8-188.ap-southeast-1.compute.internal
ip-172-31-7-85.ap-southeast-1.compute.internal
ip-172-31-15-57.ap-southeast-1.compute.internal
ip-172-31-15-159.ap-southeast-1.compute.internal
ip-172-31-4-164.ap-southeast-1.compute.internal
ip-172-31-2-196.ap-southeast-1.compute.internal
ip-172-31-8-220.ap-southeast-1.compute.internal
ip-172-31-11-71.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/docker-compose.yml 'ip-172-31-11-71.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/docker-compose-generated.yml 'ip-172-31-11-71.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ fold -w 8
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=A9n3zjL0
+ TABLE_PREFIX=A9n3zjL0-
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bhotel /tmp/
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- TABLE_PREFIX=A9n3zjL0- AWS_REGION=ap-southeast-1 /tmp/bhotel/init create baseline
buser status: ACTIVE
bsearch status: ACTIVE
bflight status: ACTIVE
bfrontend status: ACTIVE
bgeo status: ACTIVE
border status: ACTIVE
bhotel status: ACTIVE
bprofile status: ACTIVE
brate status: ACTIVE
brecommendation status: CREATING
brecommendation status: ACTIVE
bgateway status: CREATING
bgateway status: ACTIVE
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- TABLE_PREFIX=A9n3zjL0- AWS_REGION=ap-southeast-1 /tmp/bhotel/init populate baseline
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-11-71.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-6-133.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-8-188.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-7-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-15-57.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-15-159.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-4-164.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-2-196.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-8-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/nightcore_config.json ip-172-31-11-71.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-6-133.ap-southeast-1.compute.internal
ip-172-31-8-188.ap-southeast-1.compute.internal
ip-172-31-7-85.ap-southeast-1.compute.internal
ip-172-31-15-57.ap-southeast-1.compute.internal
ip-172-31-15-159.ap-southeast-1.compute.internal
ip-172-31-4-164.ap-southeast-1.compute.internal
ip-172-31-2-196.ap-southeast-1.compute.internal
ip-172-31-8-220.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-6-133.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-8-188.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-7-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-15-57.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-15-159.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-4-164.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-2-196.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/run_launcher ip-172-31-8-220.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- TABLE_PREFIX=A9n3zjL0- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-gateway
Creating service boki_flight-service
Creating service boki_hotel-service
Creating service boki_user-service
Creating service boki_order-service
Creating service boki_search-service
Creating service boki_zookeeper-setup
Creating service boki_boki-engine
Creating service boki_geo-service
Creating service boki_rate-service
Creating service boki_recommendation-service
Creating service boki_zookeeper
Creating service boki_frontend-service
Creating service boki_gateway-service
Creating service boki_profile-service
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-6-133.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=dec600dca2d495b3bb93e68bc9eca17b754a31bf8b141c26bd5b03fa63313b0f
+ echo 4096
+ ssh -q ip-172-31-6-133.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/dec600dca2d495b3bb93e68bc9eca17b754a31bf8b141c26bd5b03fa63313b0f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-8-188.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2895f3c36e054cf7e968a27ee59a547cc24241aa3dc68bb0c33d3bcb0b86b642
+ echo 4096
+ ssh -q ip-172-31-8-188.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2895f3c36e054cf7e968a27ee59a547cc24241aa3dc68bb0c33d3bcb0b86b642/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-7-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b980d34a23f1636c067b4f752142b17278d5cd3f85f994f3b07512412b82df39
+ ssh -q ip-172-31-7-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b980d34a23f1636c067b4f752142b17278d5cd3f85f994f3b07512412b82df39/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-15-57.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c5900975e35de3999dc0f39bc750b8f4cedf7543d7bafaaa1b9c35650c6223d5
+ echo 4096
+ ssh -q ip-172-31-15-57.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c5900975e35de3999dc0f39bc750b8f4cedf7543d7bafaaa1b9c35650c6223d5/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-15-159.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b36f22b00fa1687b5ac12ac913abdc952955237fc7bfcee779845fb2bd9576b2
+ echo 4096
+ ssh -q ip-172-31-15-159.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b36f22b00fa1687b5ac12ac913abdc952955237fc7bfcee779845fb2bd9576b2/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-4-164.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f841d63cf5d284f6bb971d46561793042f546dcaa10055cb97dd4f77f684e421
+ echo 4096
+ ssh -q ip-172-31-4-164.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f841d63cf5d284f6bb971d46561793042f546dcaa10055cb97dd4f77f684e421/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-2-196.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=fedcd33a013548a229925490ed46a0bae2f01756152a45e30facda2a702494d2
+ echo 4096
+ ssh -q ip-172-31-2-196.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/fedcd33a013548a229925490ed46a0bae2f01756152a45e30facda2a702494d2/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel --service boki-engine --machine-host ip-172-31-8-220.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=518a8e5467d06405d63a94553f546aa5b566442fe8176a0a640487d524a69261
+ echo 4096
+ ssh -q ip-172-31-8-220.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/518a8e5467d06405d63a94553f546aa5b566442fe8176a0a640487d524a69261/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS900
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS900
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-11-71.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/hotel/workload.lua ip-172-31-15-205.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-11-71.ap-southeast-1.compute.internal:8080 -R 900
+ sleep 10
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-11-71.ap-southeast-1.compute.internal:8080 -R 900
+ sleep 10
+ scp -q ip-172-31-11-71.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS900
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-hotel/results/QPS900/async_results
+ ssh -q ip-172-31-15-205.ap-southeast-1.compute.internal -- TABLE_PREFIX=A9n3zjL0- AWS_REGION=ap-southeast-1 /tmp/bhotel/init clean baseline
finished QPS900
Finish setup in 44.130 seconds
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS450
+ QPS=450
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ MANAGER_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ CLIENT_HOST=ip-172-31-1-36.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ ALL_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal
ip-172-31-13-227.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose-generated.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- docker stack rm boki
Nothing found in stack: boki
+ sleep 40
++ head -n 1
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
+ TABLE_PREFIX=aINU4FYE
+ TABLE_PREFIX=aINU4FYE-
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
fb0b3276a519: Pulling fs layer
04650d0140a3: Pulling fs layer
2bde0ecdcf0b: Pulling fs layer
631d66a347c9: Pulling fs layer
e3176dba68e3: Pulling fs layer
2c4530d68e03: Pulling fs layer
2c4530d68e03: Waiting
631d66a347c9: Waiting
e3176dba68e3: Waiting
fb0b3276a519: Download complete
2bde0ecdcf0b: Verifying Checksum
2bde0ecdcf0b: Download complete
04650d0140a3: Verifying Checksum
04650d0140a3: Download complete
fb0b3276a519: Pull complete
2c4530d68e03: Verifying Checksum
2c4530d68e03: Download complete
631d66a347c9: Verifying Checksum
631d66a347c9: Download complete
e3176dba68e3: Verifying Checksum
e3176dba68e3: Download complete
04650d0140a3: Pull complete
2bde0ecdcf0b: Pull complete
631d66a347c9: Pull complete
e3176dba68e3: Pull complete
2c4530d68e03: Pull complete
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Downloaded newer image for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bmedia /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/internal/media/data/compressed.json ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=aINU4FYE- AWS_REGION=ap-southeast-1 /tmp/bmedia/init create baseline
bCastInfo status: ACTIVE
bComposeReview status: ACTIVE
bFrontend status: ACTIVE
bMovieId status: ACTIVE
bMovieInfo status: ACTIVE
bMovieReview status: ACTIVE
bPage status: ACTIVE
bPlot status: ACTIVE
bRating status: ACTIVE
bReviewStorage status: ACTIVE
bText status: ACTIVE
bUniqueId status: ACTIVE
bUser status: CREATING
bUser status: ACTIVE
bUserReview status: CREATING
bUserReview status: ACTIVE
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=aINU4FYE- AWS_REGION=ap-southeast-1 /tmp/bmedia/init populate baseline /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- TABLE_PREFIX=aINU4FYE- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_cast-info-service
Creating service boki_compose-review-service
Creating service boki_movie-review-service
Creating service boki_page-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_frontend
Creating service boki_movie-id-service
Creating service boki_unique-id-service
Creating service boki_zookeeper
Creating service boki_plot-service
Creating service boki_review-storage-service
Creating service boki_movie-info-service
Creating service boki_rating-service
Creating service boki_text-service
Creating service boki_user-review-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-0-153.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=17598aee83495f42a55be3b67149bab78cf93583c697f0431f5f97da5325d0fa
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/17598aee83495f42a55be3b67149bab78cf93583c697f0431f5f97da5325d0fa/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-245.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7dc623627516db92bf458eb96b980e2cfef2c9ec68ee31acc31db2ed6590d2be
+ echo 4096
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7dc623627516db92bf458eb96b980e2cfef2c9ec68ee31acc31db2ed6590d2be/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-7-98.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2cd9a290634ec06dbd0b7a280e9c71f08a858a79fb537e042677f5946ef93435
+ echo 4096
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2cd9a290634ec06dbd0b7a280e9c71f08a858a79fb537e042677f5946ef93435/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-13-249.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f1ec43e30a51a91ec73009f027cd44cd599d9d9816239b295c9433f653d57b8a
+ echo 4096
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f1ec43e30a51a91ec73009f027cd44cd599d9d9816239b295c9433f653d57b8a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-4-184.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=dfceb13ea80f734a9cf1829f2378039c8a1c0c851034e7d8b0c5d09a9e626c56
+ echo 4096
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/dfceb13ea80f734a9cf1829f2378039c8a1c0c851034e7d8b0c5d09a9e626c56/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-12-238.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=ff6d806aae2b095c191205a9ce680f5e0643f72742c2c70f3cb2954d4e123467
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/ff6d806aae2b095c191205a9ce680f5e0643f72742c2c70f3cb2954d4e123467/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-2-244.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=86c19204bc7e54efdd31e0e6fe401075ad9c5e78047d7b2578e23be07a0e6d07
+ echo 4096
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/86c19204bc7e54efdd31e0e6fe401075ad9c5e78047d7b2578e23be07a0e6d07/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-27.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d5a3f532542f44aa3b2f7e8e4aa7b06630d32348c18f6785903a745c907632a2
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d5a3f532542f44aa3b2f7e8e4aa7b06630d32348c18f6785903a745c907632a2/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS450
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS450
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/media/workload.lua ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 450
+ sleep 10
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 450
+ sleep 10
+ scp -q ip-172-31-13-227.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS450
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS450/async_results
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=aINU4FYE- AWS_REGION=ap-southeast-1 /tmp/bmedia/init clean baseline
finished QPS450
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS500
+ QPS=500
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ MANAGER_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ CLIENT_HOST=ip-172-31-1-36.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ ALL_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal
ip-172-31-13-227.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose-generated.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ fold -w 8
++ tr -dc a-zA-Z0-9
++ head -n 1
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=uOwJ0QtM
+ TABLE_PREFIX=uOwJ0QtM-
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bmedia /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/internal/media/data/compressed.json ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=uOwJ0QtM- AWS_REGION=ap-southeast-1 /tmp/bmedia/init create baseline
bCastInfo status: ACTIVE
bComposeReview status: ACTIVE
bFrontend status: ACTIVE
bMovieId status: ACTIVE
bMovieInfo status: ACTIVE
bMovieReview status: ACTIVE
bPage status: ACTIVE
bPlot status: ACTIVE
bRating status: ACTIVE
bReviewStorage status: ACTIVE
bText status: ACTIVE
bUniqueId status: ACTIVE
bUser status: CREATING
bUser status: CREATING
bUser status: ACTIVE
bUserReview status: ACTIVE
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=uOwJ0QtM- AWS_REGION=ap-southeast-1 /tmp/bmedia/init populate baseline /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- TABLE_PREFIX=uOwJ0QtM- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_cast-info-service
Creating service boki_movie-review-service
Creating service boki_text-service
Creating service boki_user-service
Creating service boki_boki-gateway
Creating service boki_movie-id-service
Creating service boki_movie-info-service
Creating service boki_unique-id-service
Creating service boki_boki-engine
Creating service boki_page-service
Creating service boki_plot-service
Creating service boki_rating-service
Creating service boki_review-storage-service
Creating service boki_zookeeper
Creating service boki_frontend
Creating service boki_user-review-service
Creating service boki_zookeeper-setup
Creating service boki_compose-review-service
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-0-153.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=3f8e611ed5cc787fc532f1461dcf9a38c73de4f7d3b8373aeaece54ccd3e1ad8
+ echo 4096
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/3f8e611ed5cc787fc532f1461dcf9a38c73de4f7d3b8373aeaece54ccd3e1ad8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-245.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=ebb1c42fd98aa536ddcc3b1445c6e036b63e9cbc53f56e7f102c021e8c6f22f8
+ echo 4096
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/ebb1c42fd98aa536ddcc3b1445c6e036b63e9cbc53f56e7f102c021e8c6f22f8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-7-98.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=1d05021fb011aaf6db76e8304cde9b433c21cb5cc3192371ee9dae959b684f45
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/1d05021fb011aaf6db76e8304cde9b433c21cb5cc3192371ee9dae959b684f45/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-13-249.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c6d21d43d0441a5806d0ba55e77ec6ceefbf9903f15fb65db321f0cd02edd5f0
+ echo 4096
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c6d21d43d0441a5806d0ba55e77ec6ceefbf9903f15fb65db321f0cd02edd5f0/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-4-184.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=073cc586acf3f6ee648c69028f12ea4ae777909d188223523adb571df0098a24
+ echo 4096
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/073cc586acf3f6ee648c69028f12ea4ae777909d188223523adb571df0098a24/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-12-238.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0398652b6d5994a7905d69ff1ae1dbe9539b4bd0669131efa99c2c8d16fe213e
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0398652b6d5994a7905d69ff1ae1dbe9539b4bd0669131efa99c2c8d16fe213e/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-2-244.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b60b4a7b395cc67736dca39868cc0e7c90eebca4100a8c5430b3c7f948e1ffe5
+ echo 4096
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b60b4a7b395cc67736dca39868cc0e7c90eebca4100a8c5430b3c7f948e1ffe5/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-27.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a35e55f428230e246fe7f0cff3cd7833826856a92db1bfa5dfd03a3e84219736
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a35e55f428230e246fe7f0cff3cd7833826856a92db1bfa5dfd03a3e84219736/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS500
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS500
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/media/workload.lua ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ scp -q ip-172-31-13-227.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS500
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS500/async_results
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=uOwJ0QtM- AWS_REGION=ap-southeast-1 /tmp/bmedia/init clean baseline
finished QPS500
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS550
+ QPS=550
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ MANAGER_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ CLIENT_HOST=ip-172-31-1-36.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ ALL_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal
ip-172-31-13-227.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose-generated.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
+ TABLE_PREFIX=CbIFWeas
+ TABLE_PREFIX=CbIFWeas-
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bmedia /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/internal/media/data/compressed.json ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=CbIFWeas- AWS_REGION=ap-southeast-1 /tmp/bmedia/init create baseline
bCastInfo status: ACTIVE
bComposeReview status: ACTIVE
bFrontend status: ACTIVE
bMovieId status: ACTIVE
bMovieInfo status: ACTIVE
bMovieReview status: ACTIVE
bPage status: ACTIVE
bPlot status: ACTIVE
bRating status: ACTIVE
bReviewStorage status: ACTIVE
bText status: ACTIVE
bUniqueId status: ACTIVE
bUser status: CREATING
bUser status: ACTIVE
bUserReview status: ACTIVE
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=CbIFWeas- AWS_REGION=ap-southeast-1 /tmp/bmedia/init populate baseline /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- TABLE_PREFIX=CbIFWeas- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_text-service
Creating service boki_unique-id-service
Creating service boki_zookeeper
Creating service boki_boki-gateway
Creating service boki_page-service
Creating service boki_rating-service
Creating service boki_review-storage-service
Creating service boki_user-review-service
Creating service boki_zookeeper-setup
Creating service boki_boki-engine
Creating service boki_movie-review-service
Creating service boki_frontend
Creating service boki_movie-id-service
Creating service boki_movie-info-service
Creating service boki_plot-service
Creating service boki_user-service
Creating service boki_cast-info-service
Creating service boki_compose-review-service
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-0-153.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=293bdf9092d07de9ebd2e03f03fc3e7eb63c8a232926ecb30964934ece77d725
+ echo 4096
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/293bdf9092d07de9ebd2e03f03fc3e7eb63c8a232926ecb30964934ece77d725/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-245.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2de97c97fdd268e8bf32d0aebea3602cde304eb812eb84fc3ef7293127ad7da1
+ echo 4096
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2de97c97fdd268e8bf32d0aebea3602cde304eb812eb84fc3ef7293127ad7da1/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-7-98.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0cb2bb2eb0f5064d8e65e5a22410b1b7aaa00a54bd0b833826e85e3adbcb3f33
+ echo 4096
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0cb2bb2eb0f5064d8e65e5a22410b1b7aaa00a54bd0b833826e85e3adbcb3f33/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-13-249.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a691aeb959ecfedd015c1acf31f0af861c1fc4dbea63acc7c01e97cc58cf0dfa
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a691aeb959ecfedd015c1acf31f0af861c1fc4dbea63acc7c01e97cc58cf0dfa/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-4-184.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=fda9cb23c783fd579b8d222bfcc04258d776b984de52b70472951a4ded74b73b
+ echo 4096
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/fda9cb23c783fd579b8d222bfcc04258d776b984de52b70472951a4ded74b73b/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-12-238.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2b8f12eadb82626c31aa327171b433da2b1a2b858feca470575e3c899959984e
+ echo 4096
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2b8f12eadb82626c31aa327171b433da2b1a2b858feca470575e3c899959984e/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-2-244.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=cfdd206547fedac971c54026f90ed54fd7ae4cb063113698cb5add0fd23cad15
+ echo 4096
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/cfdd206547fedac971c54026f90ed54fd7ae4cb063113698cb5add0fd23cad15/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-27.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4bd521e4dd77342ebc5af2cc71dce3a464e73a5c61b61789bc4fe9a066dd6c8d
+ echo 4096
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4bd521e4dd77342ebc5af2cc71dce3a464e73a5c61b61789bc4fe9a066dd6c8d/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS550
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS550
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/media/workload.lua ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 550
+ sleep 10
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 550
+ sleep 10
+ scp -q ip-172-31-13-227.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS550
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS550/async_results
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=CbIFWeas- AWS_REGION=ap-southeast-1 /tmp/bmedia/init clean baseline
finished QPS550
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS600
+ QPS=600
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ MANAGER_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ CLIENT_HOST=ip-172-31-1-36.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ ALL_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal
ip-172-31-13-227.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose-generated.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -c 64 /dev/urandom
++ head -n 1
++ fold -w 8
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=KgCWwKxB
+ TABLE_PREFIX=KgCWwKxB-
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bmedia /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/internal/media/data/compressed.json ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=KgCWwKxB- AWS_REGION=ap-southeast-1 /tmp/bmedia/init create baseline
bCastInfo status: ACTIVE
bComposeReview status: ACTIVE
bFrontend status: ACTIVE
bMovieId status: ACTIVE
bMovieInfo status: ACTIVE
bMovieReview status: ACTIVE
bPage status: ACTIVE
bPlot status: ACTIVE
bRating status: ACTIVE
bReviewStorage status: ACTIVE
bText status: ACTIVE
bUniqueId status: ACTIVE
bUser status: CREATING
bUser status: ACTIVE
bUserReview status: ACTIVE
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=KgCWwKxB- AWS_REGION=ap-southeast-1 /tmp/bmedia/init populate baseline /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- TABLE_PREFIX=KgCWwKxB- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_movie-id-service
Creating service boki_zookeeper-setup
Creating service boki_boki-gateway
Creating service boki_frontend
Creating service boki_plot-service
Creating service boki_text-service
Creating service boki_unique-id-service
Creating service boki_zookeeper
Creating service boki_boki-engine
Creating service boki_cast-info-service
Creating service boki_movie-info-service
Creating service boki_movie-review-service
Creating service boki_page-service
Creating service boki_user-review-service
Creating service boki_user-service
Creating service boki_compose-review-service
Creating service boki_rating-service
Creating service boki_review-storage-service
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-0-153.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=894b00992eb162b09dfc6fef6e0f0db4c3d312597fbfbbae3cea3adaea0d8928
+ echo 4096
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/894b00992eb162b09dfc6fef6e0f0db4c3d312597fbfbbae3cea3adaea0d8928/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-245.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a9ff869e76c260c36305728c827f3bd982290cc03b97d84a5167054c303a5f59
+ echo 4096
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a9ff869e76c260c36305728c827f3bd982290cc03b97d84a5167054c303a5f59/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-7-98.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=48f0d67e2ab1c3e05a92c6435d9e158872d337d64301f56cae5b0dc32b78bd00
+ echo 4096
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/48f0d67e2ab1c3e05a92c6435d9e158872d337d64301f56cae5b0dc32b78bd00/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-13-249.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=032a791235c76263472514d79331fe1f06d76aceeaa1177155d488da6ebe26bb
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/032a791235c76263472514d79331fe1f06d76aceeaa1177155d488da6ebe26bb/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-4-184.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=23389099bca06f30bc433d1ccf9557d185046224ec887d287abdda282bf9b0cf
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/23389099bca06f30bc433d1ccf9557d185046224ec887d287abdda282bf9b0cf/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-12-238.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=95a6d158ec60ad1b00d921b662ecf46109eec8b3e876f78923772d2823cbf245
+ echo 4096
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/95a6d158ec60ad1b00d921b662ecf46109eec8b3e876f78923772d2823cbf245/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-2-244.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a7ffa35eaad1c4dd9f5c37afcbb535443c889ba3df64463582a731471965878e
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a7ffa35eaad1c4dd9f5c37afcbb535443c889ba3df64463582a731471965878e/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-27.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d12a2a1e4b2b02760ccac5d23c13f3c967a12f19bbe129aa71c1d249fb15863b
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d12a2a1e4b2b02760ccac5d23c13f3c967a12f19bbe129aa71c1d249fb15863b/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS600
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS600
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/media/workload.lua ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ scp -q ip-172-31-13-227.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS600
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS600/async_results
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=KgCWwKxB- AWS_REGION=ap-southeast-1 /tmp/bmedia/init clean baseline
finished QPS600
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS650
+ QPS=650
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ MANAGER_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ CLIENT_HOST=ip-172-31-1-36.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ ALL_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal
ip-172-31-13-227.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose-generated.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
+ TABLE_PREFIX=jhnZLln1
+ TABLE_PREFIX=jhnZLln1-
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bmedia /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/internal/media/data/compressed.json ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=jhnZLln1- AWS_REGION=ap-southeast-1 /tmp/bmedia/init create baseline
bCastInfo status: ACTIVE
bComposeReview status: ACTIVE
bFrontend status: ACTIVE
bMovieId status: ACTIVE
bMovieInfo status: ACTIVE
bMovieReview status: ACTIVE
bPage status: ACTIVE
bPlot status: ACTIVE
bRating status: ACTIVE
bReviewStorage status: ACTIVE
bText status: ACTIVE
bUniqueId status: ACTIVE
bUser status: CREATING
bUser status: ACTIVE
bUserReview status: CREATING
bUserReview status: ACTIVE
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=jhnZLln1- AWS_REGION=ap-southeast-1 /tmp/bmedia/init populate baseline /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- TABLE_PREFIX=jhnZLln1- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_movie-info-service
Creating service boki_plot-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_text-service
Creating service boki_zookeeper-setup
Creating service boki_page-service
Creating service boki_review-storage-service
Creating service boki_cast-info-service
Creating service boki_user-service
Creating service boki_movie-id-service
Creating service boki_movie-review-service
Creating service boki_rating-service
Creating service boki_unique-id-service
Creating service boki_user-review-service
Creating service boki_zookeeper
Creating service boki_compose-review-service
Creating service boki_frontend
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-0-153.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=44d7ea364d6160d7e0c4a79c7d540d88a5ae2c2268a8750c424ecdb300f27b2e
+ echo 4096
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/44d7ea364d6160d7e0c4a79c7d540d88a5ae2c2268a8750c424ecdb300f27b2e/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-245.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=386a54ee7dacceaba9901d4e12cec8765755c2f8733918053fc1ed24e61a22d8
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/386a54ee7dacceaba9901d4e12cec8765755c2f8733918053fc1ed24e61a22d8/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-7-98.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b8e6b62fcfa3059e17ebcf1a177f259cf29ccaee36863888d9c0e1ce1b2aced1
+ echo 4096
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b8e6b62fcfa3059e17ebcf1a177f259cf29ccaee36863888d9c0e1ce1b2aced1/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-13-249.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=eebfbd202846066081150adb460668bac64c7077e434a06e4e182e7b4becd99c
+ echo 4096
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/eebfbd202846066081150adb460668bac64c7077e434a06e4e182e7b4becd99c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-4-184.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=9efcf94b9f85efa9b765529891f248e08697240db594a693d0542e17b4558a64
+ echo 4096
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/9efcf94b9f85efa9b765529891f248e08697240db594a693d0542e17b4558a64/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-12-238.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=90a600de97d90ff28088800ec64f5b4d3751875b68d01c8b95c6c8c6c1361d40
+ echo 4096
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/90a600de97d90ff28088800ec64f5b4d3751875b68d01c8b95c6c8c6c1361d40/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-2-244.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5d3d94ed2b41f68fa1e11103eaea39aaeff6a579e262cac96bdaca94a577d532
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5d3d94ed2b41f68fa1e11103eaea39aaeff6a579e262cac96bdaca94a577d532/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-27.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=38edbabb5638f0488196a76a4fa226b8a03168cf27d6e214a164876ad78bce50
+ echo 4096
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/38edbabb5638f0488196a76a4fa226b8a03168cf27d6e214a164876ad78bce50/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS650
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS650
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/media/workload.lua ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 650
+ sleep 10
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 650
+ sleep 10
+ scp -q ip-172-31-13-227.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS650
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS650/async_results
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=jhnZLln1- AWS_REGION=ap-southeast-1 /tmp/bmedia/init clean baseline
finished QPS650
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS700
+ QPS=700
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ MANAGER_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ CLIENT_HOST=ip-172-31-1-36.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-227.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ ALL_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal
ip-172-31-13-227.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/docker-compose-generated.yml 'ip-172-31-13-227.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
+ TABLE_PREFIX=BCVUXWyP
+ TABLE_PREFIX=BCVUXWyP-
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /beldi-bin/bmedia /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/internal/media/data/compressed.json ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=BCVUXWyP- AWS_REGION=ap-southeast-1 /tmp/bmedia/init create baseline
bCastInfo status: ACTIVE
bComposeReview status: ACTIVE
bFrontend status: ACTIVE
bMovieId status: ACTIVE
bMovieInfo status: ACTIVE
bMovieReview status: ACTIVE
bPage status: ACTIVE
bPlot status: ACTIVE
bRating status: ACTIVE
bReviewStorage status: ACTIVE
bText status: ACTIVE
bUniqueId status: CREATING
bUniqueId status: ACTIVE
bUser status: ACTIVE
bUserReview status: ACTIVE
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=BCVUXWyP- AWS_REGION=ap-southeast-1 /tmp/bmedia/init populate baseline /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/nightcore_config.json ip-172-31-13-227.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-0-153.ap-southeast-1.compute.internal
ip-172-31-11-245.ap-southeast-1.compute.internal
ip-172-31-7-98.ap-southeast-1.compute.internal
ip-172-31-13-249.ap-southeast-1.compute.internal
ip-172-31-4-184.ap-southeast-1.compute.internal
ip-172-31-12-238.ap-southeast-1.compute.internal
ip-172-31-2-244.ap-southeast-1.compute.internal
ip-172-31-11-27.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-0-153.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-245.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-7-98.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-13-249.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-4-184.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-12-238.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-2-244.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/run_launcher ip-172-31-11-27.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS=
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- TABLE_PREFIX=BCVUXWyP- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_text-service
Creating service boki_unique-id-service
Creating service boki_user-service
Creating service boki_zookeeper
Creating service boki_plot-service
Creating service boki_rating-service
Creating service boki_movie-review-service
Creating service boki_review-storage-service
Creating service boki_user-review-service
Creating service boki_compose-review-service
Creating service boki_movie-id-service
Creating service boki_zookeeper-setup
Creating service boki_boki-gateway
Creating service boki_movie-info-service
Creating service boki_frontend
Creating service boki_page-service
Creating service boki_boki-engine
Creating service boki_cast-info-service
+ sleep 60
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-0-153.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=aac9b39fd0779b613bd42bd2a1f0644a779beef9f65d062578c03aca5f2e1e64
+ echo 4096
+ ssh -q ip-172-31-0-153.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/aac9b39fd0779b613bd42bd2a1f0644a779beef9f65d062578c03aca5f2e1e64/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-245.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=44c55963c3677a509dd156d50103cec17d1f510a1f67baa46acafa7aed53ee10
+ echo 4096
+ ssh -q ip-172-31-11-245.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/44c55963c3677a509dd156d50103cec17d1f510a1f67baa46acafa7aed53ee10/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-7-98.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8e78cc76123d0e0d836045821231ec3155796d55605e5cca6c45f0f1627dca3d
+ ssh -q ip-172-31-7-98.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8e78cc76123d0e0d836045821231ec3155796d55605e5cca6c45f0f1627dca3d/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-13-249.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d7c2cb05e500399efd30e49c8aa6d6d3f75857e326ba8c6531cc999859c8353d
+ echo 4096
+ ssh -q ip-172-31-13-249.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d7c2cb05e500399efd30e49c8aa6d6d3f75857e326ba8c6531cc999859c8353d/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-4-184.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=588e709a060cebc84b800a7665872f9ddba4d14a1942981981323a6a1540ba9b
+ echo 4096
+ ssh -q ip-172-31-4-184.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/588e709a060cebc84b800a7665872f9ddba4d14a1942981981323a6a1540ba9b/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-12-238.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=df327b40d49cbd1f804897c7ba749467d69c02118a077dc067ff7f97958714cb
+ echo 4096
+ ssh -q ip-172-31-12-238.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/df327b40d49cbd1f804897c7ba749467d69c02118a077dc067ff7f97958714cb/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-2-244.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=819151b7230881cdf169905ffe7c10ea9d302e7b8d9a66513d0cc6582b5de4f4
+ echo 4096
+ ssh -q ip-172-31-2-244.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/819151b7230881cdf169905ffe7c10ea9d302e7b8d9a66513d0cc6582b5de4f4/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie --service boki-engine --machine-host ip-172-31-11-27.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=948d014e6ad401c1bb31a33836aa2e61f06f8884b7490c4bf5a9dae1fa4a3353
+ echo 4096
+ ssh -q ip-172-31-11-27.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/948d014e6ad401c1bb31a33836aa2e61f06f8884b7490c4bf5a9dae1fa4a3353/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS700
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS700
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-227.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/beldi/benchmark/media/workload.lua ip-172-31-1-36.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-227.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ scp -q ip-172-31-13-227.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS700
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/baseline-movie/results/QPS700/async_results
+ ssh -q ip-172-31-1-36.ap-southeast-1.compute.internal -- TABLE_PREFIX=BCVUXWyP- AWS_REGION=ap-southeast-1 /tmp/bmedia/init clean baseline
finished QPS700
Finish setup in 81.617 seconds
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS800
+ QPS=800
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ MANAGER_HOST=ip-172-31-3-101.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ CLIENT_HOST=ip-172-31-12-13.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-3-101.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ ALL_HOSTS='ip-172-31-9-20.ap-southeast-1.compute.internal
ip-172-31-7-180.ap-southeast-1.compute.internal
ip-172-31-9-92.ap-southeast-1.compute.internal
ip-172-31-15-39.ap-southeast-1.compute.internal
ip-172-31-6-194.ap-southeast-1.compute.internal
ip-172-31-14-45.ap-southeast-1.compute.internal
ip-172-31-11-30.ap-southeast-1.compute.internal
ip-172-31-6-81.ap-southeast-1.compute.internal
ip-172-31-3-101.ap-southeast-1.compute.internal
ip-172-31-3-175.ap-southeast-1.compute.internal
ip-172-31-15-110.ap-southeast-1.compute.internal
ip-172-31-14-167.ap-southeast-1.compute.internal
ip-172-31-4-238.ap-southeast-1.compute.internal
ip-172-31-3-215.ap-southeast-1.compute.internal
ip-172-31-3-91.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/docker-compose.yml 'ip-172-31-3-101.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/docker-compose-generated.yml 'ip-172-31-3-101.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- docker stack rm boki
Nothing found in stack: boki
+ sleep 40
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
++ head -n 1
++ fold -w 8
+ TABLE_PREFIX=d8q0CiQH
+ TABLE_PREFIX=d8q0CiQH-
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
fb0b3276a519: Pulling fs layer
04650d0140a3: Pulling fs layer
2bde0ecdcf0b: Pulling fs layer
631d66a347c9: Pulling fs layer
e3176dba68e3: Pulling fs layer
2c4530d68e03: Pulling fs layer
631d66a347c9: Waiting
e3176dba68e3: Waiting
2c4530d68e03: Waiting
fb0b3276a519: Verifying Checksum
fb0b3276a519: Download complete
2bde0ecdcf0b: Verifying Checksum
2bde0ecdcf0b: Download complete
04650d0140a3: Verifying Checksum
04650d0140a3: Download complete
fb0b3276a519: Pull complete
2c4530d68e03: Download complete
631d66a347c9: Verifying Checksum
631d66a347c9: Download complete
e3176dba68e3: Verifying Checksum
e3176dba68e3: Download complete
04650d0140a3: Pull complete
2bde0ecdcf0b: Pull complete
631d66a347c9: Pull complete
e3176dba68e3: Pull complete
2c4530d68e03: Pull complete
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Downloaded newer image for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/hotel /tmp/
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- TABLE_PREFIX=d8q0CiQH- AWS_REGION=ap-southeast-1 /tmp/hotel/init create cayon
user status: CREATING
user status: CREATING
search status: CREATING
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- TABLE_PREFIX=d8q0CiQH- AWS_REGION=ap-southeast-1 /tmp/hotel/init populate cayon
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-3-101.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-9-20.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-7-180.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-9-92.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-15-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-6-194.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-14-45.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-11-30.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-6-81.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-101.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-175.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-15-110.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-14-167.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-4-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-215.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-91.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-9-20.ap-southeast-1.compute.internal
ip-172-31-7-180.ap-southeast-1.compute.internal
ip-172-31-9-92.ap-southeast-1.compute.internal
ip-172-31-15-39.ap-southeast-1.compute.internal
ip-172-31-6-194.ap-southeast-1.compute.internal
ip-172-31-14-45.ap-southeast-1.compute.internal
ip-172-31-11-30.ap-southeast-1.compute.internal
ip-172-31-6-81.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-9-20.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-7-180.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-9-92.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-15-39.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-6-194.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-14-45.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-11-30.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-6-81.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-4-238.ap-southeast-1.compute.internal
ip-172-31-3-215.ap-southeast-1.compute.internal
ip-172-31-3-91.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-4-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-4-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-3-215.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-3-215.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-3-91.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-3-91.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- TABLE_PREFIX=d8q0CiQH- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-storage
Creating service boki_flight-service
Creating service boki_profile-service
Creating service boki_rate-service
Creating service boki_user-service
Creating service boki_boki-gateway
Creating service boki_hotel-service
Creating service boki_geo-service
Creating service boki_search-service
Creating service boki_zookeeper
Creating service boki_zookeeper-setup
Creating service boki_boki-engine
Creating service boki_boki-sequencer
Creating service boki_frontend-service
Creating service boki_gateway-service
Creating service boki_order-service
Creating service boki_recommendation-service
Creating service boki_boki-controller
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-9-20.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e73bc3ccd8b6c18eec1502a02cf8cb6eb3a58d70abf2628787ecb2d4a7707fab
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e73bc3ccd8b6c18eec1502a02cf8cb6eb3a58d70abf2628787ecb2d4a7707fab/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-7-180.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=6bb8f3ab5f95ab0c53bad3a1feda055a0284a5eac4966afbea470a0736f3afe8
+ echo 4096
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/6bb8f3ab5f95ab0c53bad3a1feda055a0284a5eac4966afbea470a0736f3afe8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-9-92.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=12b4b1299a51c8ecb376423b98b76d072fba569c09d534f6c145d528baf21b4c
+ echo 4096
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/12b4b1299a51c8ecb376423b98b76d072fba569c09d534f6c145d528baf21b4c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-15-39.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c19d08cb12b90fd36ca426a7c93eb4f7336a6cb008fed77c1a2b02845fec2651
+ echo 4096
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c19d08cb12b90fd36ca426a7c93eb4f7336a6cb008fed77c1a2b02845fec2651/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-6-194.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=fe3f34b895d251538c5fc3d63a9f191e12bfc171bf72f3676bbfe7523b71a336
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/fe3f34b895d251538c5fc3d63a9f191e12bfc171bf72f3676bbfe7523b71a336/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-14-45.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5c67992a51f5c729a23b2d16544c111cab9aefcabcbf984b2ba27e28fe1ba88e
+ echo 4096
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5c67992a51f5c729a23b2d16544c111cab9aefcabcbf984b2ba27e28fe1ba88e/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-11-30.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=58a2e51d6169eeb264e9dd57ae52d1d749c7902d00ff988bcf7012856d6a61df
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/58a2e51d6169eeb264e9dd57ae52d1d749c7902d00ff988bcf7012856d6a61df/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-6-81.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=1c71b88bee6801e3a257d7016eef07d390dabbbb11ec78ce2cb8c5f333dd55fc
+ echo 4096
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/1c71b88bee6801e3a257d7016eef07d390dabbbb11ec78ce2cb8c5f333dd55fc/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS800
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS800
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/hotel/workload.lua ip-172-31-12-13.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-3-101.ap-southeast-1.compute.internal:8080 -R 800
+ sleep 10
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-3-101.ap-southeast-1.compute.internal:8080 -R 800
+ sleep 10
+ scp -q ip-172-31-3-101.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS800
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS800/async_results
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py:3432: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/_methods.py:190: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
Traceback (most recent call last):
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 50, in <module>
    p50, p99, avg = compute_latency(
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 37, in compute_latency
    p50 = np.percentile(filtered, 50) / 1000.0
  File "<__array_function__ internals>", line 180, in percentile
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4166, in percentile
    return _quantile_unchecked(
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4424, in _quantile_unchecked
    r, k = _ureduce(a,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 3725, in _ureduce
    r = func(a, **kwargs)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4593, in _quantile_ureduce_func
    result = _quantile(arr,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4699, in _quantile
    take(arr, indices=-1, axis=DATA_AXIS)
  File "<__array_function__ internals>", line 180, in take
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 190, in take
    return _wrapfunc(a, 'take', indices, axis=axis, out=out, mode=mode)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
IndexError: cannot do a non-empty take from an empty axes.
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- TABLE_PREFIX=d8q0CiQH- AWS_REGION=ap-southeast-1 /tmp/hotel/init clean cayon
finished QPS800
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS900
+ QPS=900
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ MANAGER_HOST=ip-172-31-3-101.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ CLIENT_HOST=ip-172-31-12-13.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-3-101.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ ALL_HOSTS='ip-172-31-9-20.ap-southeast-1.compute.internal
ip-172-31-7-180.ap-southeast-1.compute.internal
ip-172-31-9-92.ap-southeast-1.compute.internal
ip-172-31-15-39.ap-southeast-1.compute.internal
ip-172-31-6-194.ap-southeast-1.compute.internal
ip-172-31-14-45.ap-southeast-1.compute.internal
ip-172-31-11-30.ap-southeast-1.compute.internal
ip-172-31-6-81.ap-southeast-1.compute.internal
ip-172-31-3-101.ap-southeast-1.compute.internal
ip-172-31-3-175.ap-southeast-1.compute.internal
ip-172-31-15-110.ap-southeast-1.compute.internal
ip-172-31-14-167.ap-southeast-1.compute.internal
ip-172-31-4-238.ap-southeast-1.compute.internal
ip-172-31-3-215.ap-southeast-1.compute.internal
ip-172-31-3-91.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/docker-compose.yml 'ip-172-31-3-101.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/docker-compose-generated.yml 'ip-172-31-3-101.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ head -c 64 /dev/urandom
++ fold -w 8
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=QHqwuZF7
+ TABLE_PREFIX=QHqwuZF7-
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/hotel /tmp/
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- TABLE_PREFIX=QHqwuZF7- AWS_REGION=ap-southeast-1 /tmp/hotel/init create cayon
user status: CREATING
user status: CREATING
gateway status: CREATING
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- TABLE_PREFIX=QHqwuZF7- AWS_REGION=ap-southeast-1 /tmp/hotel/init populate cayon
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-3-101.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-9-20.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-7-180.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-9-92.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-15-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-6-194.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-14-45.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-11-30.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-6-81.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-101.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-175.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-15-110.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-14-167.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-4-238.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-215.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/nightcore_config.json ip-172-31-3-91.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-9-20.ap-southeast-1.compute.internal
ip-172-31-7-180.ap-southeast-1.compute.internal
ip-172-31-9-92.ap-southeast-1.compute.internal
ip-172-31-15-39.ap-southeast-1.compute.internal
ip-172-31-6-194.ap-southeast-1.compute.internal
ip-172-31-14-45.ap-southeast-1.compute.internal
ip-172-31-11-30.ap-southeast-1.compute.internal
ip-172-31-6-81.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-9-20.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-7-180.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-9-92.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-15-39.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-6-194.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-14-45.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-11-30.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/run_launcher ip-172-31-6-81.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-4-238.ap-southeast-1.compute.internal
ip-172-31-3-215.ap-southeast-1.compute.internal
ip-172-31-3-91.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-4-238.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-4-238.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-3-215.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-3-215.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-3-91.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-3-91.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- TABLE_PREFIX=QHqwuZF7- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_search-service
Creating service boki_boki-controller
Creating service boki_boki-gateway
Creating service boki_boki-storage
Creating service boki_geo-service
Creating service boki_rate-service
Creating service boki_boki-engine
Creating service boki_frontend-service
Creating service boki_user-service
Creating service boki_flight-service
Creating service boki_hotel-service
Creating service boki_order-service
Creating service boki_zookeeper-setup
Creating service boki_boki-sequencer
Creating service boki_gateway-service
Creating service boki_profile-service
Creating service boki_recommendation-service
Creating service boki_zookeeper
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-9-20.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=6fdcd02669c433cc748c55280c970a862281fe968e36bb7996bddcb3cb0ba53b
+ echo 4096
+ ssh -q ip-172-31-9-20.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/6fdcd02669c433cc748c55280c970a862281fe968e36bb7996bddcb3cb0ba53b/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-7-180.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c9089d460e32f8c1b0c663c973d3c0246573705a9b88c82552c0e8f60d84cc39
+ echo 4096
+ ssh -q ip-172-31-7-180.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c9089d460e32f8c1b0c663c973d3c0246573705a9b88c82552c0e8f60d84cc39/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-9-92.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=411a36529d4595c719452307bd04b7e8796a1dc4430b5495e6c4bf9202cc71e6
+ echo 4096
+ ssh -q ip-172-31-9-92.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/411a36529d4595c719452307bd04b7e8796a1dc4430b5495e6c4bf9202cc71e6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-15-39.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e545e22a867b9e417bb9031ea1b575d89cd29228e02b3d64ffe72f32bb4b77c6
+ echo 4096
+ ssh -q ip-172-31-15-39.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e545e22a867b9e417bb9031ea1b575d89cd29228e02b3d64ffe72f32bb4b77c6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-6-194.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b82b90186dc207b35e1d6eb80dde6ed8c3155938f6fddf8b8b83ca7c44ec13d2
+ echo 4096
+ ssh -q ip-172-31-6-194.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b82b90186dc207b35e1d6eb80dde6ed8c3155938f6fddf8b8b83ca7c44ec13d2/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-14-45.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=101edd9fe0be91cfaa35dfa5bcdb63890dee62b551c43f736c80992f4976d20c
+ ssh -q ip-172-31-14-45.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/101edd9fe0be91cfaa35dfa5bcdb63890dee62b551c43f736c80992f4976d20c/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-11-30.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0eeae28d4b9a35ad0c4a806e87f3d4e296b0e7bb04eb2c082a4735f2e32cbcb4
+ ssh -q ip-172-31-11-30.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0eeae28d4b9a35ad0c4a806e87f3d4e296b0e7bb04eb2c082a4735f2e32cbcb4/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel --service boki-engine --machine-host ip-172-31-6-81.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8ee2d96a5a0300437a5e3c54ba47eb463912e7a04c52442308a0d346cb8fd8cb
+ echo 4096
+ ssh -q ip-172-31-6-81.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8ee2d96a5a0300437a5e3c54ba47eb463912e7a04c52442308a0d346cb8fd8cb/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS900
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS900
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-3-101.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/hotel/workload.lua ip-172-31-12-13.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-3-101.ap-southeast-1.compute.internal:8080 -R 900
+ sleep 10
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-3-101.ap-southeast-1.compute.internal:8080 -R 900
+ sleep 10
+ scp -q ip-172-31-3-101.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS900
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-hotel/results/QPS900/async_results
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py:3432: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/_methods.py:190: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
Traceback (most recent call last):
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 50, in <module>
    p50, p99, avg = compute_latency(
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 37, in compute_latency
    p50 = np.percentile(filtered, 50) / 1000.0
  File "<__array_function__ internals>", line 180, in percentile
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4166, in percentile
    return _quantile_unchecked(
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4424, in _quantile_unchecked
    r, k = _ureduce(a,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 3725, in _ureduce
    r = func(a, **kwargs)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4593, in _quantile_ureduce_func
    result = _quantile(arr,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4699, in _quantile
    take(arr, indices=-1, axis=DATA_AXIS)
  File "<__array_function__ internals>", line 180, in take
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 190, in take
    return _wrapfunc(a, 'take', indices, axis=axis, out=out, mode=mode)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
IndexError: cannot do a non-empty take from an empty axes.
+ ssh -q ip-172-31-12-13.ap-southeast-1.compute.internal -- TABLE_PREFIX=QHqwuZF7- AWS_REGION=ap-southeast-1 /tmp/hotel/init clean cayon
finished QPS900
Finish setup in 71.050 seconds
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS450
+ QPS=450
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ MANAGER_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ CLIENT_HOST=ip-172-31-7-92.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ ALL_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal
ip-172-31-9-250.ap-southeast-1.compute.internal
ip-172-31-14-27.ap-southeast-1.compute.internal
ip-172-31-2-220.ap-southeast-1.compute.internal
ip-172-31-13-253.ap-southeast-1.compute.internal
ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose-generated.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- docker stack rm boki
Nothing found in stack: boki
+ sleep 40
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
++ fold -w 8
++ head -n 1
+ TABLE_PREFIX=nXqj7mYM
+ TABLE_PREFIX=nXqj7mYM-
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
fb0b3276a519: Pulling fs layer
04650d0140a3: Pulling fs layer
2bde0ecdcf0b: Pulling fs layer
631d66a347c9: Pulling fs layer
e3176dba68e3: Pulling fs layer
2c4530d68e03: Pulling fs layer
631d66a347c9: Waiting
e3176dba68e3: Waiting
2c4530d68e03: Waiting
fb0b3276a519: Verifying Checksum
fb0b3276a519: Download complete
2bde0ecdcf0b: Verifying Checksum
2bde0ecdcf0b: Download complete
04650d0140a3: Verifying Checksum
04650d0140a3: Download complete
fb0b3276a519: Pull complete
2c4530d68e03: Verifying Checksum
2c4530d68e03: Download complete
631d66a347c9: Verifying Checksum
631d66a347c9: Download complete
e3176dba68e3: Verifying Checksum
e3176dba68e3: Download complete
04650d0140a3: Pull complete
2bde0ecdcf0b: Pull complete
631d66a347c9: Pull complete
e3176dba68e3: Pull complete
2c4530d68e03: Pull complete
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Downloaded newer image for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=nXqj7mYM- AWS_REGION=ap-southeast-1 /tmp/media/init create cayon
CastInfo status: CREATING
CastInfo status: CREATING
ComposeReview status: CREATING
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=nXqj7mYM- AWS_REGION=ap-southeast-1 /tmp/media/init populate cayon /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-253.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-154.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-12-87.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-6-34.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- TABLE_PREFIX=nXqj7mYM- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_review-storage-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
Creating service boki_boki-controller
Creating service boki_frontend
Creating service boki_movie-id-service
Creating service boki_movie-review-service
Creating service boki_boki-gateway
Creating service boki_page-service
Creating service boki_user-review-service
Creating service boki_boki-engine
Creating service boki_boki-sequencer
Creating service boki_boki-storage
Creating service boki_cast-info-service
Creating service boki_text-service
Creating service boki_unique-id-service
Creating service boki_zookeeper
Creating service boki_compose-review-service
Creating service boki_movie-info-service
Creating service boki_plot-service
Creating service boki_rating-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-13-206.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8701bb2304ced8ff1749dfad2da283155ce2bd59dc346e1db864869b43f7870c
+ echo 4096
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8701bb2304ced8ff1749dfad2da283155ce2bd59dc346e1db864869b43f7870c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-3-76.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8581fab929476369ab4b781a25d37925e7b4dfd514ab769575e32b3861e6d300
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8581fab929476369ab4b781a25d37925e7b4dfd514ab769575e32b3861e6d300/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5e8438817df21ec9862585e76ac6e5cb4cda1326a81cda6c7215848d3f51e6d5
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5e8438817df21ec9862585e76ac6e5cb4cda1326a81cda6c7215848d3f51e6d5/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-123.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2b08f9644156add09a947a534925ae7b0abe911635310f323cffea0306501763
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2b08f9644156add09a947a534925ae7b0abe911635310f323cffea0306501763/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-2-162.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=53ae0872f9e1f622cac86b9896f63770cbfeda416382ebf6140d0e28282fb7a9
+ echo 4096
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/53ae0872f9e1f622cac86b9896f63770cbfeda416382ebf6140d0e28282fb7a9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-161.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=169047c8499a8182ac233ff55c6ff839a0b3c918bc4134260d27c0398ce12e4f
+ echo 4096
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/169047c8499a8182ac233ff55c6ff839a0b3c918bc4134260d27c0398ce12e4f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-213.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a239670aa1e009e19cdbb4d0178c4e6944195976f47e482a01d7dff545107463
+ echo 4096
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a239670aa1e009e19cdbb4d0178c4e6944195976f47e482a01d7dff545107463/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-124.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d2e9a3a1a4bfa2df405a5c7b64ff12856efd22b6dc624abe465759ee892d0329
+ echo 4096
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d2e9a3a1a4bfa2df405a5c7b64ff12856efd22b6dc624abe465759ee892d0329/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS450
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS450
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/media/workload.lua ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 450
+ sleep 10
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 450
+ sleep 10
+ scp -q ip-172-31-9-250.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS450
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS450/async_results
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=nXqj7mYM- AWS_REGION=ap-southeast-1 /tmp/media/init clean cayon
finished QPS450
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS500
+ QPS=500
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ MANAGER_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ CLIENT_HOST=ip-172-31-7-92.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ ALL_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal
ip-172-31-9-250.ap-southeast-1.compute.internal
ip-172-31-14-27.ap-southeast-1.compute.internal
ip-172-31-2-220.ap-southeast-1.compute.internal
ip-172-31-13-253.ap-southeast-1.compute.internal
ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose-generated.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ tr -dc a-zA-Z0-9
++ fold -w 8
++ head -c 64 /dev/urandom
++ head -n 1
+ TABLE_PREFIX=Jrsfar9w
+ TABLE_PREFIX=Jrsfar9w-
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=Jrsfar9w- AWS_REGION=ap-southeast-1 /tmp/media/init create cayon
CastInfo status: CREATING
CastInfo status: CREATING
MovieInfo status: CREATING
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=Jrsfar9w- AWS_REGION=ap-southeast-1 /tmp/media/init populate cayon /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-253.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-154.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-12-87.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-6-34.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- TABLE_PREFIX=Jrsfar9w- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_review-storage-service
Creating service boki_user-service
Creating service boki_compose-review-service
Creating service boki_frontend
Creating service boki_movie-info-service
Creating service boki_plot-service
Creating service boki_rating-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_movie-id-service
Creating service boki_text-service
Creating service boki_zookeeper
Creating service boki_unique-id-service
Creating service boki_user-review-service
Creating service boki_boki-controller
Creating service boki_boki-sequencer
Creating service boki_boki-storage
Creating service boki_cast-info-service
Creating service boki_movie-review-service
Creating service boki_page-service
Creating service boki_zookeeper-setup
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-13-206.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2f29da85e544697024d20287d0cd9f145decd33f7c96a99a718a77c4969472ba
+ echo 4096
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2f29da85e544697024d20287d0cd9f145decd33f7c96a99a718a77c4969472ba/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-3-76.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=df00c45196d84711fd808dc5a3a27e5704f95a25591b1902050e94a0ffa3b1b1
+ echo 4096
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/df00c45196d84711fd808dc5a3a27e5704f95a25591b1902050e94a0ffa3b1b1/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=63617ed47146a74a94478aa3b67bffc861f55b606ae69f13343fca6bdefa2c9e
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/63617ed47146a74a94478aa3b67bffc861f55b606ae69f13343fca6bdefa2c9e/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-123.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a33fd81def253957bee2201af045dc936bb609eafba4d69168bd4b0c05dac77f
+ echo 4096
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a33fd81def253957bee2201af045dc936bb609eafba4d69168bd4b0c05dac77f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-2-162.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7b5a9f2077c3e3f8ff9713cf102c159f609b3736d61b2c91ac10750ff0893a95
+ echo 4096
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7b5a9f2077c3e3f8ff9713cf102c159f609b3736d61b2c91ac10750ff0893a95/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-161.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=9ad196d3823844894cf3a62093bc151bc53f50ad5004de9f82fccaea780159b8
+ echo 4096
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/9ad196d3823844894cf3a62093bc151bc53f50ad5004de9f82fccaea780159b8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-213.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=da4a309dfadf53c40fc9716486e5fac580b58891e585f83507c42e2c20e75f1a
+ echo 4096
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/da4a309dfadf53c40fc9716486e5fac580b58891e585f83507c42e2c20e75f1a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-124.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=251bc3dcb3744a4844965519fc517e7a87ba41795b7e97840acb071a8ef275d9
+ echo 4096
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/251bc3dcb3744a4844965519fc517e7a87ba41795b7e97840acb071a8ef275d9/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS500
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS500
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/media/workload.lua ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ scp -q ip-172-31-9-250.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS500
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS500/async_results
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=Jrsfar9w- AWS_REGION=ap-southeast-1 /tmp/media/init clean cayon
finished QPS500
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS550
+ QPS=550
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ MANAGER_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ CLIENT_HOST=ip-172-31-7-92.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ ALL_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal
ip-172-31-9-250.ap-southeast-1.compute.internal
ip-172-31-14-27.ap-southeast-1.compute.internal
ip-172-31-2-220.ap-southeast-1.compute.internal
ip-172-31-13-253.ap-southeast-1.compute.internal
ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose-generated.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ fold -w 8
++ tr -dc a-zA-Z0-9
++ head -n 1
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=NJJAqaB0
+ TABLE_PREFIX=NJJAqaB0-
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=NJJAqaB0- AWS_REGION=ap-southeast-1 /tmp/media/init create cayon
CastInfo status: CREATING
CastInfo status: CREATING
ComposeReview status: CREATING
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=NJJAqaB0- AWS_REGION=ap-southeast-1 /tmp/media/init populate cayon /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-253.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-154.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-12-87.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-6-34.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- TABLE_PREFIX=NJJAqaB0- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_unique-id-service
Creating service boki_zookeeper-setup
Creating service boki_boki-storage
Creating service boki_compose-review-service
Creating service boki_plot-service
Creating service boki_text-service
Creating service boki_boki-controller
Creating service boki_cast-info-service
Creating service boki_zookeeper
Creating service boki_review-storage-service
Creating service boki_frontend
Creating service boki_movie-info-service
Creating service boki_page-service
Creating service boki_rating-service
Creating service boki_movie-review-service
Creating service boki_user-review-service
Creating service boki_user-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_boki-sequencer
Creating service boki_movie-id-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-13-206.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8f6cbd558d0840fdaed71db04a34cf313c75d33e8be7c21c283938313294258a
+ echo 4096
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8f6cbd558d0840fdaed71db04a34cf313c75d33e8be7c21c283938313294258a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-3-76.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4e1ad82ceca2a41e3e2feaaed74390e6b369825572f3db26b111ca0a191cc02b
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4e1ad82ceca2a41e3e2feaaed74390e6b369825572f3db26b111ca0a191cc02b/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=934b364deba24adfb4b63dafe49d418ba9f8d816d7e9fbfc066d620d55e6bac9
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/934b364deba24adfb4b63dafe49d418ba9f8d816d7e9fbfc066d620d55e6bac9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-123.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=98ac51b83fc7d288a5e4ae7bd2f98ace01d83490cd5c41aad459cd57594d07da
+ echo 4096
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/98ac51b83fc7d288a5e4ae7bd2f98ace01d83490cd5c41aad459cd57594d07da/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-2-162.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e0c9a427f26e5f75952c67991656195870801a540d881e379067947806e24c76
+ echo 4096
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e0c9a427f26e5f75952c67991656195870801a540d881e379067947806e24c76/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-161.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=37883ad50c1eb0a51a4b013133b2a297ec70e7adb06e2a69e154be86b00711f6
+ echo 4096
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/37883ad50c1eb0a51a4b013133b2a297ec70e7adb06e2a69e154be86b00711f6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-213.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0b271d4f5f18f4645d73dbc3292636ca9d0ca019688ccf4089a3d697cf18f392
+ echo 4096
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0b271d4f5f18f4645d73dbc3292636ca9d0ca019688ccf4089a3d697cf18f392/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-124.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=12366e6c3583fa30ee2a392971e9893e72637008f5c077a3ed51cd48d27b173f
+ echo 4096
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/12366e6c3583fa30ee2a392971e9893e72637008f5c077a3ed51cd48d27b173f/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS550
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS550
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/media/workload.lua ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 550
+ sleep 10
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 550
+ sleep 10
+ scp -q ip-172-31-9-250.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS550
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS550/async_results
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=NJJAqaB0- AWS_REGION=ap-southeast-1 /tmp/media/init clean cayon
finished QPS550
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS600
+ QPS=600
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ MANAGER_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ CLIENT_HOST=ip-172-31-7-92.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ ALL_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal
ip-172-31-9-250.ap-southeast-1.compute.internal
ip-172-31-14-27.ap-southeast-1.compute.internal
ip-172-31-2-220.ap-southeast-1.compute.internal
ip-172-31-13-253.ap-southeast-1.compute.internal
ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose-generated.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ fold -w 8
++ head -n 1
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=UsrIsVWE
+ TABLE_PREFIX=UsrIsVWE-
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=UsrIsVWE- AWS_REGION=ap-southeast-1 /tmp/media/init create cayon
CastInfo status: CREATING
CastInfo status: CREATING
CastInfo status: CREATING
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=UsrIsVWE- AWS_REGION=ap-southeast-1 /tmp/media/init populate cayon /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-253.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-154.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-12-87.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-6-34.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- TABLE_PREFIX=UsrIsVWE- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_user-review-service
Creating service boki_boki-controller
Creating service boki_boki-storage
Creating service boki_movie-info-service
Creating service boki_text-service
Creating service boki_unique-id-service
Creating service boki_zookeeper
Creating service boki_boki-engine
Creating service boki_compose-review-service
Creating service boki_frontend
Creating service boki_rating-service
Creating service boki_review-storage-service
Creating service boki_boki-gateway
Creating service boki_boki-sequencer
Creating service boki_movie-id-service
Creating service boki_plot-service
Creating service boki_cast-info-service
Creating service boki_movie-review-service
Creating service boki_page-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-13-206.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=04269dfa3d86db289c7ab0bc75b9dcadcd00cc3d05b1c953c9a5bef73f0d4c6d
+ echo 4096
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/04269dfa3d86db289c7ab0bc75b9dcadcd00cc3d05b1c953c9a5bef73f0d4c6d/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-3-76.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2db08bd371a478b10e8b0f468cd4d5a1eba2e08544fe32363db77f9003e21ecb
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2db08bd371a478b10e8b0f468cd4d5a1eba2e08544fe32363db77f9003e21ecb/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b384484719605b5245bdb5987165876a937560c6b17a990e9d3321781239f248
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b384484719605b5245bdb5987165876a937560c6b17a990e9d3321781239f248/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-123.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=46b84b0732486d8db5d1ffbc5432788312db32852f6f9aacf5b00f9301342240
+ echo 4096
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/46b84b0732486d8db5d1ffbc5432788312db32852f6f9aacf5b00f9301342240/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-2-162.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e18d1a2e883bc9d6bfa6f6e6eb15b4f77d039963b61e852255c5970523bbb023
+ echo 4096
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e18d1a2e883bc9d6bfa6f6e6eb15b4f77d039963b61e852255c5970523bbb023/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-161.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=46e37f3c818c192cfaab79335b705fa09079521d22b0ea8876ebf1eac754f342
+ echo 4096
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/46e37f3c818c192cfaab79335b705fa09079521d22b0ea8876ebf1eac754f342/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-213.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=65dcd7a193ba2927d4f5eec9e21d4a913809a353a513419381f505359cc7d05e
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/65dcd7a193ba2927d4f5eec9e21d4a913809a353a513419381f505359cc7d05e/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-124.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0db4622f5a4116224c09ab3a043e72772ddf9b628b12e6fa01e43b7315349c6a
+ echo 4096
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0db4622f5a4116224c09ab3a043e72772ddf9b628b12e6fa01e43b7315349c6a/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS600
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS600
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/media/workload.lua ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ scp -q ip-172-31-9-250.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS600
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS600/async_results
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=UsrIsVWE- AWS_REGION=ap-southeast-1 /tmp/media/init clean cayon
finished QPS600
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS650
+ QPS=650
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ MANAGER_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ CLIENT_HOST=ip-172-31-7-92.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ ALL_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal
ip-172-31-9-250.ap-southeast-1.compute.internal
ip-172-31-14-27.ap-southeast-1.compute.internal
ip-172-31-2-220.ap-southeast-1.compute.internal
ip-172-31-13-253.ap-southeast-1.compute.internal
ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose-generated.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
++ head -n 1
+ TABLE_PREFIX=6gNEJ44Q
+ TABLE_PREFIX=6gNEJ44Q-
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=6gNEJ44Q- AWS_REGION=ap-southeast-1 /tmp/media/init create cayon
CastInfo status: CREATING
CastInfo status: CREATING
CastInfo status: CREATING
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=6gNEJ44Q- AWS_REGION=ap-southeast-1 /tmp/media/init populate cayon /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-253.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-154.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-12-87.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-6-34.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- TABLE_PREFIX=6gNEJ44Q- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_movie-id-service
Creating service boki_movie-info-service
Creating service boki_review-storage-service
Creating service boki_text-service
Creating service boki_user-service
Creating service boki_zookeeper
Creating service boki_zookeeper-setup
Creating service boki_boki-sequencer
Creating service boki_movie-review-service
Creating service boki_unique-id-service
Creating service boki_boki-controller
Creating service boki_boki-engine
Creating service boki_frontend
Creating service boki_plot-service
Creating service boki_user-review-service
Creating service boki_boki-gateway
Creating service boki_boki-storage
Creating service boki_cast-info-service
Creating service boki_compose-review-service
Creating service boki_page-service
Creating service boki_rating-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-13-206.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4748af59ceb405ce67ca459db042a80d4d6f48aa46b88c1ecedd8fc2eccb81d2
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4748af59ceb405ce67ca459db042a80d4d6f48aa46b88c1ecedd8fc2eccb81d2/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-3-76.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=6cf22ee3c4a6c090350385620453366e95b74230bd996db010412cfd8fa93598
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/6cf22ee3c4a6c090350385620453366e95b74230bd996db010412cfd8fa93598/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e4253da15899d241e647428e4a0c6b2dfa483e0cc4f57497d55bd3176235d86a
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e4253da15899d241e647428e4a0c6b2dfa483e0cc4f57497d55bd3176235d86a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-123.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c80777e4c682d64f901424785f363d05dda92a15eb073e0a7c35034561865554
+ echo 4096
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c80777e4c682d64f901424785f363d05dda92a15eb073e0a7c35034561865554/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-2-162.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=aeb93d77620436c4f404ed6c0cab47d34c08f7a1dd06f8d1a018122e5667064b
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/aeb93d77620436c4f404ed6c0cab47d34c08f7a1dd06f8d1a018122e5667064b/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-161.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f85933e60460d0010701d13eb2fdaed2247b70e4dc982334045d1431be02768d
+ echo 4096
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f85933e60460d0010701d13eb2fdaed2247b70e4dc982334045d1431be02768d/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-213.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=ba6bb853cc911b40c22b250dddc5d134f87be3e4f533b1d8df1ef374917a19e8
+ echo 4096
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/ba6bb853cc911b40c22b250dddc5d134f87be3e4f533b1d8df1ef374917a19e8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-124.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=13dbae75edb1b584b059b0cd9950ab181d27a4f853bfc874db1a19d620dbcf7f
+ echo 4096
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/13dbae75edb1b584b059b0cd9950ab181d27a4f853bfc874db1a19d620dbcf7f/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS650
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS650
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/media/workload.lua ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 650
+ sleep 10
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 650
+ sleep 10
+ scp -q ip-172-31-9-250.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS650
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS650/async_results
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=6gNEJ44Q- AWS_REGION=ap-southeast-1 /tmp/media/init clean cayon
finished QPS650
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS700
+ QPS=700
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ MANAGER_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ CLIENT_HOST=ip-172-31-7-92.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-9-250.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ ALL_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal
ip-172-31-9-250.ap-southeast-1.compute.internal
ip-172-31-14-27.ap-southeast-1.compute.internal
ip-172-31-2-220.ap-southeast-1.compute.internal
ip-172-31-13-253.ap-southeast-1.compute.internal
ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/docker-compose-generated.yml 'ip-172-31-9-250.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ fold -w 8
++ head -c 64 /dev/urandom
++ head -n 1
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=DlZXfdLx
+ TABLE_PREFIX=DlZXfdLx-
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /bokiflow-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=DlZXfdLx- AWS_REGION=ap-southeast-1 /tmp/media/init create cayon
CastInfo status: CREATING
CastInfo status: CREATING
ComposeReview status: CREATING
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=DlZXfdLx- AWS_REGION=ap-southeast-1 /tmp/media/init populate cayon /tmp/compressed.json
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-9-250.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-27.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-2-220.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-13-253.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-14-154.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-12-87.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/nightcore_config.json ip-172-31-6-34.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-13-206.ap-southeast-1.compute.internal
ip-172-31-3-76.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-11-123.ap-southeast-1.compute.internal
ip-172-31-2-162.ap-southeast-1.compute.internal
ip-172-31-5-161.ap-southeast-1.compute.internal
ip-172-31-5-213.ap-southeast-1.compute.internal
ip-172-31-11-124.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-13-206.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-3-76.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-123.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-2-162.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-161.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-5-213.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/run_launcher ip-172-31-11-124.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-14-154.ap-southeast-1.compute.internal
ip-172-31-12-87.ap-southeast-1.compute.internal
ip-172-31-6-34.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-14-154.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-12-87.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-6-34.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- TABLE_PREFIX=DlZXfdLx- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_unique-id-service
Creating service boki_user-review-service
Creating service boki_zookeeper
Creating service boki_boki-controller
Creating service boki_compose-review-service
Creating service boki_frontend
Creating service boki_movie-info-service
Creating service boki_movie-id-service
Creating service boki_page-service
Creating service boki_zookeeper-setup
Creating service boki_cast-info-service
Creating service boki_rating-service
Creating service boki_text-service
Creating service boki_user-service
Creating service boki_movie-review-service
Creating service boki_plot-service
Creating service boki_review-storage-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_boki-sequencer
Creating service boki_boki-storage
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-13-206.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=877ece51a36a762d3f554389496c400f9a629a7b63d5d74de27394c680741ff3
+ ssh -q ip-172-31-13-206.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/877ece51a36a762d3f554389496c400f9a629a7b63d5d74de27394c680741ff3/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-3-76.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=852fdbb5511dcd6c5181456b8a1816cf354a8f7ddb8bfb6b6814fa7ef2268748
+ ssh -q ip-172-31-3-76.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/852fdbb5511dcd6c5181456b8a1816cf354a8f7ddb8bfb6b6814fa7ef2268748/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=04153bdead2e869391d1491ddc9050597ef3c2fe729e484461b534d39a40207e
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/04153bdead2e869391d1491ddc9050597ef3c2fe729e484461b534d39a40207e/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-123.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c292dd43d8eddd00381e01453843201ee098511174f6c3e9035fe6dd5f274b4f
+ echo 4096
+ ssh -q ip-172-31-11-123.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c292dd43d8eddd00381e01453843201ee098511174f6c3e9035fe6dd5f274b4f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-2-162.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f543b99a736dc6d2642df8ec521ab7e65414368c062441c51ea456485905ced2
+ ssh -q ip-172-31-2-162.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f543b99a736dc6d2642df8ec521ab7e65414368c062441c51ea456485905ced2/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-161.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d03b99225a3f3712a443f00f45fc6c6c323ca43a4a46c9dbbe422feb0707bd5d
+ echo 4096
+ ssh -q ip-172-31-5-161.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d03b99225a3f3712a443f00f45fc6c6c323ca43a4a46c9dbbe422feb0707bd5d/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-5-213.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=892d69a849c437cc1d956de6b8f5efd781bd2a66af8f9b37357a58593e9f6ce7
+ echo 4096
+ ssh -q ip-172-31-5-213.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/892d69a849c437cc1d956de6b8f5efd781bd2a66af8f9b37357a58593e9f6ce7/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie --service boki-engine --machine-host ip-172-31-11-124.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a621649b4b42022c4fecfd145aa0883466f6d0a27f952d7d64d45f4c288e25a0
+ echo 4096
+ ssh -q ip-172-31-11-124.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a621649b4b42022c4fecfd145aa0883466f6d0a27f952d7d64d45f4c288e25a0/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS700
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS700
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-9-250.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/benchmark/media/workload.lua ip-172-31-7-92.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-9-250.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ scp -q ip-172-31-9-250.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS700
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/boki-movie/results/QPS700/async_results
+ ssh -q ip-172-31-7-92.ap-southeast-1.compute.internal -- TABLE_PREFIX=DlZXfdLx- AWS_REGION=ap-southeast-1 /tmp/media/init clean cayon
finished QPS700
Finish setup in 73.262 seconds
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS100
+ QPS=100
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Nothing found in stack: boki
+ sleep 40
++ head -n 1
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
+ TABLE_PREFIX=Q88XSZRw
+ TABLE_PREFIX=Q88XSZRw-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
fb0b3276a519: Pulling fs layer
04650d0140a3: Pulling fs layer
2bde0ecdcf0b: Pulling fs layer
631d66a347c9: Pulling fs layer
e3176dba68e3: Pulling fs layer
2c4530d68e03: Pulling fs layer
631d66a347c9: Waiting
e3176dba68e3: Waiting
2c4530d68e03: Waiting
fb0b3276a519: Verifying Checksum
fb0b3276a519: Download complete
2bde0ecdcf0b: Verifying Checksum
2bde0ecdcf0b: Download complete
04650d0140a3: Verifying Checksum
04650d0140a3: Download complete
fb0b3276a519: Pull complete
2c4530d68e03: Verifying Checksum
2c4530d68e03: Download complete
631d66a347c9: Verifying Checksum
631d66a347c9: Download complete
e3176dba68e3: Verifying Checksum
e3176dba68e3: Download complete
04650d0140a3: Pull complete
2bde0ecdcf0b: Pull complete
631d66a347c9: Pull complete
e3176dba68e3: Pull complete
2c4530d68e03: Pull complete
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Downloaded newer image for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=Q88XSZRw- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 12:31:42 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
hotel status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=Q88XSZRw- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 12:31:52 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=Q88XSZRw- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-engine
Creating service boki_hotel-service
Creating service boki_profile-service
Creating service boki_rate-service
Creating service boki_recommendation-service
Creating service boki_zookeeper
Creating service boki_boki-sequencer
Creating service boki_flight-service
Creating service boki_user-service
Creating service boki_boki-gateway
Creating service boki_frontend-service
Creating service boki_order-service
Creating service boki_search-service
Creating service boki_boki-controller
Creating service boki_boki-storage
Creating service boki_gateway-service
Creating service boki_geo-service
Creating service boki_zookeeper-setup
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5b23a91384027a3ba265e28da47ebc2260327cdeb4fac285d38ed0644f40afbf
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5b23a91384027a3ba265e28da47ebc2260327cdeb4fac285d38ed0644f40afbf/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7e7f891c9e413646fde9698f8d9483b94de47fdea2bd0601693778005ab691f5
+ echo 4096
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7e7f891c9e413646fde9698f8d9483b94de47fdea2bd0601693778005ab691f5/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d2c5a219fa66022ebaa992248c9aba07d21dc026aa6aa6cbb381214b070f7368
+ echo 4096
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d2c5a219fa66022ebaa992248c9aba07d21dc026aa6aa6cbb381214b070f7368/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7836a2ec9f90485858c0c51e306076cfd511091fce13292b33a11984587b02ac
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7836a2ec9f90485858c0c51e306076cfd511091fce13292b33a11984587b02ac/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e78c6e03a91aa4546a42145ac0048881ca1233bc11db433e31e2b10706313742
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e78c6e03a91aa4546a42145ac0048881ca1233bc11db433e31e2b10706313742/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=aa256f9d4674bdeb5978239cf6872a1ff85f95d9b5027459b41093a110846a59
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/aa256f9d4674bdeb5978239cf6872a1ff85f95d9b5027459b41093a110846a59/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0fb66b96643b7fefbaaa85e2add0adab098980ebbdd250c0c32e500e7aa3fd7f
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0fb66b96643b7fefbaaa85e2add0adab098980ebbdd250c0c32e500e7aa3fd7f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f3cef9c0f44ab5f3cf5a16f824cb3c456a9e2d616c8dac5e9c8ab364923790ea
+ echo 4096
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f3cef9c0f44ab5f3cf5a16f824cb3c456a9e2d616c8dac5e9c8ab364923790ea/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS100
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS100
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 100
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 100
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS100
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS100/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=Q88XSZRw- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 12:38:32 [INFO] log mode: WRITELOG
finished QPS100
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS200
+ QPS=200
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ fold -w 8
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=3veynu2r
+ TABLE_PREFIX=3veynu2r-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=3veynu2r- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 12:39:19 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
search status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=3veynu2r- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 12:39:29 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=3veynu2r- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-controller
Creating service boki_frontend-service
Creating service boki_hotel-service
Creating service boki_rate-service
Creating service boki_boki-sequencer
Creating service boki_boki-storage
Creating service boki_flight-service
Creating service boki_boki-gateway
Creating service boki_geo-service
Creating service boki_profile-service
Creating service boki_recommendation-service
Creating service boki_search-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
Creating service boki_boki-engine
Creating service boki_gateway-service
Creating service boki_order-service
Creating service boki_zookeeper
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b65446db72e655a9d2ee3efd5878c4782cf1e2db9193162c039323bba8d7890d
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b65446db72e655a9d2ee3efd5878c4782cf1e2db9193162c039323bba8d7890d/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2edf2638cda26104f1dfc171375deec8ba24e039a452cbe9b020915c340c719f
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2edf2638cda26104f1dfc171375deec8ba24e039a452cbe9b020915c340c719f/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e73dc3d0bd1468ac2cfefbdf579bb1841d9643bb56b4ab4381841afdcdaae29a
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e73dc3d0bd1468ac2cfefbdf579bb1841d9643bb56b4ab4381841afdcdaae29a/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=844e4775dbd01bf1f7340f74d1c85f9b0dc444c9a795936b8166bffa7fed89de
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/844e4775dbd01bf1f7340f74d1c85f9b0dc444c9a795936b8166bffa7fed89de/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=9269d7471937b5ce4bb9492f6ca4bbe916a17ccc57f0bd6079cdf17c6d6ed6d0
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/9269d7471937b5ce4bb9492f6ca4bbe916a17ccc57f0bd6079cdf17c6d6ed6d0/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=0129343d59f25c09384957643d7495c4e8302a0933730ba79cdb8df892eacec6
+ echo 4096
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/0129343d59f25c09384957643d7495c4e8302a0933730ba79cdb8df892eacec6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5094bb3aac904435388895138374db34baf79986d14c3478986307e128bff16d
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5094bb3aac904435388895138374db34baf79986d14c3478986307e128bff16d/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8c59e0840a3bd6da5c4cafbd11510b2289111b7b7192094852a435f1d46b5734
+ echo 4096
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8c59e0840a3bd6da5c4cafbd11510b2289111b7b7192094852a435f1d46b5734/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS200
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS200
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 200
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 200
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS200
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS200/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=3veynu2r- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 12:46:11 [INFO] log mode: WRITELOG
finished QPS200
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS300
+ QPS=300
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ fold -w 8
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=4pO0fFvY
+ TABLE_PREFIX=4pO0fFvY-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=4pO0fFvY- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 12:46:58 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=4pO0fFvY- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 12:47:05 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=4pO0fFvY- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_flight-service
Creating service boki_recommendation-service
Creating service boki_zookeeper-setup
Creating service boki_boki-sequencer
Creating service boki_frontend-service
Creating service boki_gateway-service
Creating service boki_geo-service
Creating service boki_order-service
Creating service boki_user-service
Creating service boki_zookeeper
Creating service boki_boki-controller
Creating service boki_boki-storage
Creating service boki_hotel-service
Creating service boki_profile-service
Creating service boki_rate-service
Creating service boki_search-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e13e8c319ffe48d848c349f48b8a7ca90411986b3968252e5e8887a8b3f848ed
+ echo 4096
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e13e8c319ffe48d848c349f48b8a7ca90411986b3968252e5e8887a8b3f848ed/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8cde96a6a5edfdddaba72ea561a1c96e6fb92d28963d06d756bccdcaa6a00791
+ echo 4096
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8cde96a6a5edfdddaba72ea561a1c96e6fb92d28963d06d756bccdcaa6a00791/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=95ad52de66cdd9c5ecbb0eeb6bcf9246f95578a22b022535205c392590f5d248
+ echo 4096
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/95ad52de66cdd9c5ecbb0eeb6bcf9246f95578a22b022535205c392590f5d248/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=be46b0214af10eb87c1b067d0939c68a6bf8de3d1f3dcc852dd4d4376d351be1
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/be46b0214af10eb87c1b067d0939c68a6bf8de3d1f3dcc852dd4d4376d351be1/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=78c902a8784a241e46a7018bb6370be02af93a0f4d3f31e3f8b38c93f1b77fbd
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/78c902a8784a241e46a7018bb6370be02af93a0f4d3f31e3f8b38c93f1b77fbd/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d2d4cdfdd2e2dd18670c0ee2d7a80d687781d2858a86fca92f5d3b7bbf84fd36
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d2d4cdfdd2e2dd18670c0ee2d7a80d687781d2858a86fca92f5d3b7bbf84fd36/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8af44b8c36355ca55178e6e9cd87af9adb8477828e7105d2487260311e45ffd8
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8af44b8c36355ca55178e6e9cd87af9adb8477828e7105d2487260311e45ffd8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f2c36a22b9104527575086845ad4975e4ab409727c83400131d714cc4435dfba
+ echo 4096
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f2c36a22b9104527575086845ad4975e4ab409727c83400131d714cc4435dfba/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS300
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS300
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 300
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 300
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS300
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS300/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=4pO0fFvY- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 12:53:48 [INFO] log mode: WRITELOG
finished QPS300
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS400
+ QPS=400
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ fold -w 8
++ head -n 1
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=MZhhVIY9
+ TABLE_PREFIX=MZhhVIY9-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=MZhhVIY9- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 12:54:35 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
frontend status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=MZhhVIY9- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 12:54:44 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=MZhhVIY9- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-gateway
Creating service boki_rate-service
Creating service boki_zookeeper
Creating service boki_boki-engine
Creating service boki_frontend-service
Creating service boki_search-service
Creating service boki_order-service
Creating service boki_profile-service
Creating service boki_recommendation-service
Creating service boki_user-service
Creating service boki_boki-sequencer
Creating service boki_boki-storage
Creating service boki_flight-service
Creating service boki_hotel-service
Creating service boki_zookeeper-setup
Creating service boki_boki-controller
Creating service boki_gateway-service
Creating service boki_geo-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=780ab735984d7673da15ad546ba89395d85f481cbc0e62b7b64644bdce820162
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/780ab735984d7673da15ad546ba89395d85f481cbc0e62b7b64644bdce820162/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2de0e7f265c72fdd88c9e44b172f1c04eb9b11aca6232a7bb4575c82299c9880
+ echo 4096
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2de0e7f265c72fdd88c9e44b172f1c04eb9b11aca6232a7bb4575c82299c9880/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c16022404b084ec53955939f454a5e62b8f8b973bc49bd8cb6a59cf094e667b0
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c16022404b084ec53955939f454a5e62b8f8b973bc49bd8cb6a59cf094e667b0/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d2343ccbf9595dceb23bc49ce1ac45d089cb753c9959ab7a8cc63ddf0b7f442c
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d2343ccbf9595dceb23bc49ce1ac45d089cb753c9959ab7a8cc63ddf0b7f442c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=fa37cc3a66537cbc3a23ff5b165f8247ac36f48892060675a8ed9b3269bf714e
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/fa37cc3a66537cbc3a23ff5b165f8247ac36f48892060675a8ed9b3269bf714e/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=46c0d638aaf728353c7956a8eaef1d8973197d31a2b46a882e5ced1b6f9da25a
+ echo 4096
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/46c0d638aaf728353c7956a8eaef1d8973197d31a2b46a882e5ced1b6f9da25a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=15569570e517abc7e93d57a5f1a536db699e7b2d2d6b978de169f13dd77fc3f5
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/15569570e517abc7e93d57a5f1a536db699e7b2d2d6b978de169f13dd77fc3f5/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=09c73ccf8ac5caba0018405a788cd641c17bb008b1c23570abaaed4c09197f4c
+ echo 4096
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/09c73ccf8ac5caba0018405a788cd641c17bb008b1c23570abaaed4c09197f4c/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS400
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS400
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 400
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 400
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS400
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS400/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=MZhhVIY9- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 13:01:28 [INFO] log mode: WRITELOG
finished QPS400
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS500
+ QPS=500
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
++ fold -w 8
+ TABLE_PREFIX=6aMHO5FE
+ TABLE_PREFIX=6aMHO5FE-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=6aMHO5FE- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 13:02:15 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
user status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=6aMHO5FE- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 13:02:25 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=6aMHO5FE- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_recommendation-service
Creating service boki_search-service
Creating service boki_boki-controller
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_boki-sequencer
Creating service boki_rate-service
Creating service boki_user-service
Creating service boki_flight-service
Creating service boki_frontend-service
Creating service boki_gateway-service
Creating service boki_hotel-service
Creating service boki_order-service
Creating service boki_boki-storage
Creating service boki_geo-service
Creating service boki_zookeeper-setup
Creating service boki_profile-service
Creating service boki_zookeeper
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=77476dbde3981694a25fe7dead2d3b39b01c02f555652db56be4cdca318b3c29
+ echo 4096
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/77476dbde3981694a25fe7dead2d3b39b01c02f555652db56be4cdca318b3c29/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=94e9be92a58334aed62db3d159143bd2ac9fb7841ac3c799f8c17643e46927a4
+ echo 4096
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/94e9be92a58334aed62db3d159143bd2ac9fb7841ac3c799f8c17643e46927a4/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=ac99cf6df3a7ba5483eca4da9d14edeee0f15c5b00f8612c766817132b2a2cb2
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/ac99cf6df3a7ba5483eca4da9d14edeee0f15c5b00f8612c766817132b2a2cb2/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b2aeddb63282c6b90b5704da304e89b500391b4238b92239fafedc93804376d2
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b2aeddb63282c6b90b5704da304e89b500391b4238b92239fafedc93804376d2/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=64978954338fbe4f432f76a3b6153438fe99bd44439faf2588c5a0e16972641f
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/64978954338fbe4f432f76a3b6153438fe99bd44439faf2588c5a0e16972641f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=75902940ad45cf2601a5b8b6cfdbda0f0c7d3ea27494993ea0b63e0e89b6f510
+ echo 4096
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/75902940ad45cf2601a5b8b6cfdbda0f0c7d3ea27494993ea0b63e0e89b6f510/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=348a5cdaca00ca8bdcb48aa82ae7e732b64b1a719a16f0eb1626794c9bea4928
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/348a5cdaca00ca8bdcb48aa82ae7e732b64b1a719a16f0eb1626794c9bea4928/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=dffc81e1843423af0c52761f3db958215eb90a542e808ff9a376af449cb22bae
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/dffc81e1843423af0c52761f3db958215eb90a542e808ff9a376af449cb22bae/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS500
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS500
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS500
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS500/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=6aMHO5FE- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 13:09:08 [INFO] log mode: WRITELOG
finished QPS500
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS600
+ QPS=600
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ fold -w 8
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ head -n 1
+ TABLE_PREFIX=YiXAqqgg
+ TABLE_PREFIX=YiXAqqgg-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=YiXAqqgg- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 13:09:55 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
search status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=YiXAqqgg- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 13:10:05 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=YiXAqqgg- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_search-service
Creating service boki_zookeeper
Creating service boki_zookeeper-setup
Creating service boki_boki-engine
Creating service boki_hotel-service
Creating service boki_order-service
Creating service boki_rate-service
Creating service boki_user-service
Creating service boki_gateway-service
Creating service boki_geo-service
Creating service boki_profile-service
Creating service boki_recommendation-service
Creating service boki_boki-controller
Creating service boki_boki-sequencer
Creating service boki_boki-storage
Creating service boki_boki-gateway
Creating service boki_flight-service
Creating service boki_frontend-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=50ac100265200368fa919286f43ecf49e7d064013325dd7c6e434888d83b23e4
+ echo 4096
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/50ac100265200368fa919286f43ecf49e7d064013325dd7c6e434888d83b23e4/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=387e6a35c189c61a65dc51f8fd95502d2e2bab73da7bfb3783b0ecff7fc5b063
+ echo 4096
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/387e6a35c189c61a65dc51f8fd95502d2e2bab73da7bfb3783b0ecff7fc5b063/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2a874e3bb73052345e8e7d94cd963bf738b5ee408e519c870f480b54011ca94a
+ echo 4096
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2a874e3bb73052345e8e7d94cd963bf738b5ee408e519c870f480b54011ca94a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8740b22dcad4df3ef1abcb2f321b82e7ac083b326b530fea74b44064880d6052
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8740b22dcad4df3ef1abcb2f321b82e7ac083b326b530fea74b44064880d6052/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=13cf53a18716610b89dc309c03befc561bacb5bb30d9a158fcb12fb1929af2a8
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/13cf53a18716610b89dc309c03befc561bacb5bb30d9a158fcb12fb1929af2a8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2ebce96afcad9eb9561c2b145318cf6d385e2b8f3dd1645fa616ba708965e139
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2ebce96afcad9eb9561c2b145318cf6d385e2b8f3dd1645fa616ba708965e139/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4635f09f68c3061250bb8c0a142f045da6a806464eb5ae2a1acbb469d375cf6c
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4635f09f68c3061250bb8c0a142f045da6a806464eb5ae2a1acbb469d375cf6c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=28ff58aa0468632fe04c85ca3801b6c7265a29c3faddf42dfbe170207ccfcdb2
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/28ff58aa0468632fe04c85ca3801b6c7265a29c3faddf42dfbe170207ccfcdb2/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS600
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS600
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS600
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS600/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=YiXAqqgg- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 13:16:48 [INFO] log mode: WRITELOG
finished QPS600
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS700
+ QPS=700
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ tr -dc a-zA-Z0-9
++ fold -w 8
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=LjbfP3PP
+ TABLE_PREFIX=LjbfP3PP-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=LjbfP3PP- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 13:17:35 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
flight status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=LjbfP3PP- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 13:17:45 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=LjbfP3PP- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-sequencer
Creating service boki_geo-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_boki-storage
Creating service boki_order-service
Creating service boki_profile-service
Creating service boki_search-service
Creating service boki_rate-service
Creating service boki_boki-controller
Creating service boki_flight-service
Creating service boki_frontend-service
Creating service boki_gateway-service
Creating service boki_hotel-service
Creating service boki_recommendation-service
Creating service boki_user-service
Creating service boki_zookeeper
Creating service boki_zookeeper-setup
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=47c20e5a4275ac43f3848dbd4da8a5bfc1755294df59616636707da897bdbabb
+ echo 4096
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/47c20e5a4275ac43f3848dbd4da8a5bfc1755294df59616636707da897bdbabb/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c5c01944115b8337fc5c79aea47ad94d59aae25037a4be49459e9885821a411d
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c5c01944115b8337fc5c79aea47ad94d59aae25037a4be49459e9885821a411d/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e467acf875ca9cf4222d2a5f5e14b336d947eda816b716db8c2615e3cf40698e
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e467acf875ca9cf4222d2a5f5e14b336d947eda816b716db8c2615e3cf40698e/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a9a3cbf87ff65673b3dc586220a857bf0f88fcc40f40f594a4206cf2916fc2fa
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a9a3cbf87ff65673b3dc586220a857bf0f88fcc40f40f594a4206cf2916fc2fa/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=9ab0e4f5b01dcc5dae5dab6370fb2128313b79170051a138dd924330de5217ec
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/9ab0e4f5b01dcc5dae5dab6370fb2128313b79170051a138dd924330de5217ec/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8391af3d2cb863670332cd9294870d411aa1b8993ed48d22a113afdcaf5473e4
+ echo 4096
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8391af3d2cb863670332cd9294870d411aa1b8993ed48d22a113afdcaf5473e4/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7e844fc49397d7eb63dcbd482e5d3f6848a5ba5d89a5268707b58816295e0b9a
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7e844fc49397d7eb63dcbd482e5d3f6848a5ba5d89a5268707b58816295e0b9a/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d7dcc771b6205f99e4a016cb0a9dbf655ba5bc4a42cd1d3cd00767e940b511eb
+ echo 4096
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d7dcc771b6205f99e4a016cb0a9dbf655ba5bc4a42cd1d3cd00767e940b511eb/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS700
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS700
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS700
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS700/async_results
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py:3432: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/_methods.py:190: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
Traceback (most recent call last):
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 50, in <module>
    p50, p99, avg = compute_latency(
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 37, in compute_latency
    p50 = np.percentile(filtered, 50) / 1000.0
  File "<__array_function__ internals>", line 180, in percentile
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4166, in percentile
    return _quantile_unchecked(
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4424, in _quantile_unchecked
    r, k = _ureduce(a,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 3725, in _ureduce
    r = func(a, **kwargs)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4593, in _quantile_ureduce_func
    result = _quantile(arr,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4699, in _quantile
    take(arr, indices=-1, axis=DATA_AXIS)
  File "<__array_function__ internals>", line 180, in take
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 190, in take
    return _wrapfunc(a, 'take', indices, axis=axis, out=out, mode=mode)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
IndexError: cannot do a non-empty take from an empty axes.
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=LjbfP3PP- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 13:24:27 [INFO] log mode: WRITELOG
finished QPS700
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS800
+ QPS=800
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ tr -dc a-zA-Z0-9
++ head -n 1
++ head -c 64 /dev/urandom
++ fold -w 8
+ TABLE_PREFIX=wdKI2Mgo
+ TABLE_PREFIX=wdKI2Mgo-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=wdKI2Mgo- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 13:25:14 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
user status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=wdKI2Mgo- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 13:25:24 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=wdKI2Mgo- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-gateway
Creating service boki_boki-storage
Creating service boki_hotel-service
Creating service boki_profile-service
Creating service boki_search-service
Creating service boki_zookeeper
Creating service boki_boki-sequencer
Creating service boki_flight-service
Creating service boki_frontend-service
Creating service boki_geo-service
Creating service boki_rate-service
Creating service boki_boki-controller
Creating service boki_boki-engine
Creating service boki_recommendation-service
Creating service boki_zookeeper-setup
Creating service boki_gateway-service
Creating service boki_order-service
Creating service boki_user-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=83557ae9be80cef0799f5b2af9cb669ea1b3327885af624428c2e8fa946fc1e1
+ echo 4096
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/83557ae9be80cef0799f5b2af9cb669ea1b3327885af624428c2e8fa946fc1e1/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=5b530a23cbb4cb211cf15566a32ba88257b51da4d44aaa66ef67140c293e40a0
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/5b530a23cbb4cb211cf15566a32ba88257b51da4d44aaa66ef67140c293e40a0/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=589d20890d1896e55dccc3380792f54fb46e8d6579cb4aa06b8bf10367603739
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/589d20890d1896e55dccc3380792f54fb46e8d6579cb4aa06b8bf10367603739/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7f8b3bd88bad4df0a7e783c9aa8caa0373056b7a4d54539ec852ccc3edc8d620
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7f8b3bd88bad4df0a7e783c9aa8caa0373056b7a4d54539ec852ccc3edc8d620/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e4d91e92b81c3d721acf4948124097b3f1822366e4ebd6c4711d12ff57b632d6
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e4d91e92b81c3d721acf4948124097b3f1822366e4ebd6c4711d12ff57b632d6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=86fbdeeb41e1a56412b22288094dda6eea987775fc96e75882a4b85951214ea9
+ echo 4096
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/86fbdeeb41e1a56412b22288094dda6eea987775fc96e75882a4b85951214ea9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=980ca2aaffc70467e72670b5aefa885d6b1007186d7faefaafcd02dd2a873c54
+ echo 4096
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/980ca2aaffc70467e72670b5aefa885d6b1007186d7faefaafcd02dd2a873c54/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=1b947b3981b71a16511ad984baa5b2e058f9402ecdedc5082f9fca1b7e8ca734
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/1b947b3981b71a16511ad984baa5b2e058f9402ecdedc5082f9fca1b7e8ca734/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS800
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS800
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 800
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 800
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS800
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS800/async_results
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py:3432: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/_methods.py:190: RuntimeWarning: invalid value encountered in double_scalars
  ret = ret.dtype.type(ret / rcount)
Traceback (most recent call last):
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 50, in <module>
    p50, p99, avg = compute_latency(
  File "/home/ubuntu/boki-benchmarks/scripts/compute_latency.py", line 37, in compute_latency
    p50 = np.percentile(filtered, 50) / 1000.0
  File "<__array_function__ internals>", line 180, in percentile
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4166, in percentile
    return _quantile_unchecked(
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4424, in _quantile_unchecked
    r, k = _ureduce(a,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 3725, in _ureduce
    r = func(a, **kwargs)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4593, in _quantile_ureduce_func
    result = _quantile(arr,
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/lib/function_base.py", line 4699, in _quantile
    take(arr, indices=-1, axis=DATA_AXIS)
  File "<__array_function__ internals>", line 180, in take
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 190, in take
    return _wrapfunc(a, 'take', indices, axis=axis, out=out, mode=mode)
  File "/home/ubuntu/.local/lib/python3.8/site-packages/numpy/core/fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
IndexError: cannot do a non-empty take from an empty axes.
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=wdKI2Mgo- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 13:32:06 [INFO] log mode: WRITELOG
finished QPS800
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS900
+ QPS=900
+ LOGMODE=write
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ MANAGER_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ CLIENT_HOST=ip-172-31-2-146.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service=boki-gateway
+ ENTRY_HOST=ip-172-31-13-56.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ ALL_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal
ip-172-31-13-56.ap-southeast-1.compute.internal
ip-172-31-4-218.ap-southeast-1.compute.internal
ip-172-31-3-104.ap-southeast-1.compute.internal
ip-172-31-4-8.ap-southeast-1.compute.internal
ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/docker-compose-generated.yml 'ip-172-31-13-56.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_flight-service
Removing service boki_frontend-service
Removing service boki_gateway-service
Removing service boki_geo-service
Removing service boki_hotel-service
Removing service boki_order-service
Removing service boki_profile-service
Removing service boki_rate-service
Removing service boki_recommendation-service
Removing service boki_search-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ tr -dc a-zA-Z0-9
++ head -n 1
++ fold -w 8
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=bSSxsWxk
+ TABLE_PREFIX=bSSxsWxk-
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/hotel /tmp/
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=bSSxsWxk- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init create cayon
2023/04/05 13:32:54 [INFO] log mode: WRITELOG
user status: CREATING
user status: CREATING
order status: CREATING
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=bSSxsWxk- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init populate cayon
2023/04/05 13:33:03 [INFO] log mode: WRITELOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-13-56.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-218.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-3-104.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-4-8.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-10-182.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/nightcore_config.json ip-172-31-1-206.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-5-174.ap-southeast-1.compute.internal
ip-172-31-10-13.ap-southeast-1.compute.internal
ip-172-31-9-52.ap-southeast-1.compute.internal
ip-172-31-1-192.ap-southeast-1.compute.internal
ip-172-31-12-47.ap-southeast-1.compute.internal
ip-172-31-1-61.ap-southeast-1.compute.internal
ip-172-31-9-13.ap-southeast-1.compute.internal
ip-172-31-0-232.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-5-174.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-10-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-52.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-192.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-12-47.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-1-61.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-9-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/run_launcher ip-172-31-0-232.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-10-182.ap-southeast-1.compute.internal
ip-172-31-1-83.ap-southeast-1.compute.internal
ip-172-31-1-206.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-10-182.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-1-206.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- TABLE_PREFIX=bSSxsWxk- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-engine
Creating service boki_boki-storage
Creating service boki_recommendation-service
Creating service boki_user-service
Creating service boki_frontend-service
Creating service boki_gateway-service
Creating service boki_geo-service
Creating service boki_order-service
Creating service boki_profile-service
Creating service boki_rate-service
Creating service boki_zookeeper
Creating service boki_boki-controller
Creating service boki_boki-sequencer
Creating service boki_flight-service
Creating service boki_search-service
Creating service boki_boki-gateway
Creating service boki_hotel-service
Creating service boki_zookeeper-setup
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-5-174.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e6d64d819a6d21bea88ea9997c422c04f552fad621603122ca2996142f0667f0
+ ssh -q ip-172-31-5-174.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e6d64d819a6d21bea88ea9997c422c04f552fad621603122ca2996142f0667f0/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-10-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=eac8888934f7c6870948e9cbb0ffb805c881f4827e562b10ec90a61dd81fa1ea
+ echo 4096
+ ssh -q ip-172-31-10-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/eac8888934f7c6870948e9cbb0ffb805c881f4827e562b10ec90a61dd81fa1ea/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-52.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=cabe33b047fa3f95285c888b6ba542a16e6f47cf5911a5f3d01734d288b67816
+ echo 4096
+ ssh -q ip-172-31-9-52.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/cabe33b047fa3f95285c888b6ba542a16e6f47cf5911a5f3d01734d288b67816/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-192.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=dc9f8f5a5728f61edcff0d07df58ff9f08f6545c28dabc98534b29708498d4e3
+ echo 4096
+ ssh -q ip-172-31-1-192.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/dc9f8f5a5728f61edcff0d07df58ff9f08f6545c28dabc98534b29708498d4e3/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-12-47.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e4f5d12d230d9bac2adc59f635de8417758f38f825321aa3cf89c1bf2e6cc36b
+ echo 4096
+ ssh -q ip-172-31-12-47.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e4f5d12d230d9bac2adc59f635de8417758f38f825321aa3cf89c1bf2e6cc36b/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-1-61.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=7bc9e8dee3d1321bc23a0d5b0d852c8ebded7a72c4a5d426f6b0a237c86942a6
+ echo 4096
+ ssh -q ip-172-31-1-61.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/7bc9e8dee3d1321bc23a0d5b0d852c8ebded7a72c4a5d426f6b0a237c86942a6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-9-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=f7aa305a28678661818e498e79476595f0c050e9e0303cf781f66f356ce12873
+ ssh -q ip-172-31-9-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/f7aa305a28678661818e498e79476595f0c050e9e0303cf781f66f356ce12873/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel --service boki-engine --machine-host ip-172-31-0-232.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=617c40308e9c66e1451109e495c72af9430139f9aa20a900d6e3d1aef3b71d99
+ ssh -q ip-172-31-0-232.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/617c40308e9c66e1451109e495c72af9430139f9aa20a900d6e3d1aef3b71d99/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS900
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS900
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-13-56.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/hotel/workload.lua ip-172-31-2-146.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 900
+ sleep 10
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-13-56.ap-southeast-1.compute.internal:8080 -R 900
+ sleep 10
+ scp -q ip-172-31-13-56.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS900
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-hotel/results/QPS900/async_results
+ ssh -q ip-172-31-2-146.ap-southeast-1.compute.internal -- TABLE_PREFIX=bSSxsWxk- AWS_REGION=ap-southeast-1 LoggingMode=write /tmp/hotel/init clean cayon
2023/04/05 13:39:47 [INFO] log mode: WRITELOG
finished QPS900
Finish setup in 76.821 seconds
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS450
+ QPS=450
+ LOGMODE=read
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ MANAGER_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ CLIENT_HOST=ip-172-31-13-226.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ ALL_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal
ip-172-31-7-44.ap-southeast-1.compute.internal
ip-172-31-1-207.ap-southeast-1.compute.internal
ip-172-31-7-66.ap-southeast-1.compute.internal
ip-172-31-8-11.ap-southeast-1.compute.internal
ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose-generated.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- docker stack rm boki
Nothing found in stack: boki
+ sleep 40
++ head -n 1
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
++ fold -w 8
+ TABLE_PREFIX=KqghIpN8
+ TABLE_PREFIX=KqghIpN8-
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
fb0b3276a519: Pulling fs layer
04650d0140a3: Pulling fs layer
2bde0ecdcf0b: Pulling fs layer
631d66a347c9: Pulling fs layer
e3176dba68e3: Pulling fs layer
2c4530d68e03: Pulling fs layer
e3176dba68e3: Waiting
2c4530d68e03: Waiting
fb0b3276a519: Download complete
2bde0ecdcf0b: Verifying Checksum
2bde0ecdcf0b: Download complete
04650d0140a3: Verifying Checksum
04650d0140a3: Download complete
fb0b3276a519: Pull complete
2c4530d68e03: Verifying Checksum
2c4530d68e03: Download complete
631d66a347c9: Verifying Checksum
631d66a347c9: Download complete
e3176dba68e3: Verifying Checksum
e3176dba68e3: Download complete
04650d0140a3: Pull complete
2bde0ecdcf0b: Pull complete
631d66a347c9: Pull complete
e3176dba68e3: Pull complete
2c4530d68e03: Pull complete
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Downloaded newer image for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=KqghIpN8- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init create cayon
2023/04/05 13:45:25 [INFO] log mode: READLOG
CastInfo status: CREATING
CastInfo status: CREATING
ComposeReview status: CREATING
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=KqghIpN8- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init populate cayon /tmp/compressed.json
2023/04/05 13:45:35 [INFO] log mode: READLOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-1-207.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-11.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-145.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-15-247.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- TABLE_PREFIX=KqghIpN8- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_unique-id-service
Creating service boki_user-review-service
Creating service boki_boki-storage
Creating service boki_movie-info-service
Creating service boki_page-service
Creating service boki_boki-sequencer
Creating service boki_cast-info-service
Creating service boki_plot-service
Creating service boki_rating-service
Creating service boki_text-service
Creating service boki_boki-controller
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_zookeeper-setup
Creating service boki_movie-review-service
Creating service boki_user-service
Creating service boki_zookeeper
Creating service boki_compose-review-service
Creating service boki_frontend
Creating service boki_movie-id-service
Creating service boki_review-storage-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-113.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=1f9806c26925cbab2dbf86b73cce813db9400aea5018c6e3a8835493399924a9
+ echo 4096
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/1f9806c26925cbab2dbf86b73cce813db9400aea5018c6e3a8835493399924a9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-59.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=63a775eb83a72b8fd20b8c327cbf5f6200bf2e6eb6bf3137b93eb22c1b800f92
+ echo 4096
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/63a775eb83a72b8fd20b8c327cbf5f6200bf2e6eb6bf3137b93eb22c1b800f92/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-83.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a2a88c9e94bdaa07c709b003753e3aef8504c66fbf4dafb48435c522f6cf19f1
+ echo 4096
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a2a88c9e94bdaa07c709b003753e3aef8504c66fbf4dafb48435c522f6cf19f1/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-10.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4c6ce6f7d9154e4b92e84667df4b301b171962be4b620e91c52e8de64656c0e7
+ echo 4096
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4c6ce6f7d9154e4b92e84667df4b301b171962be4b620e91c52e8de64656c0e7/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-8-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c4ee6fcc5f33af6d1b9a6eed904b06f973e7211c9ee483da8dfe4decf629d51c
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c4ee6fcc5f33af6d1b9a6eed904b06f973e7211c9ee483da8dfe4decf629d51c/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-199.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=921bf333880b3c619df7fad7ce4b5a2ce832320ba1f850c1511ac286f89ddbb9
+ echo 4096
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/921bf333880b3c619df7fad7ce4b5a2ce832320ba1f850c1511ac286f89ddbb9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8ce73b7d84d8ad8f8131c299e2611e2716c76fecf0a44f201716225277b5bbba
+ echo 4096
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8ce73b7d84d8ad8f8131c299e2611e2716c76fecf0a44f201716225277b5bbba/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-5-66.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=e9b00bb160d45ced3387f29aea570552260d0dbf9e0a7908c2aa10eb160d9d11
+ echo 4096
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/e9b00bb160d45ced3387f29aea570552260d0dbf9e0a7908c2aa10eb160d9d11/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS450
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS450
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/media/workload.lua ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 450
+ sleep 10
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 450
+ sleep 10
+ scp -q ip-172-31-7-44.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS450
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS450/async_results
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=KqghIpN8- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init clean cayon
2023/04/05 13:52:44 [INFO] log mode: READLOG
finished QPS450
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS500
+ QPS=500
+ LOGMODE=read
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ MANAGER_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ CLIENT_HOST=ip-172-31-13-226.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ ALL_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal
ip-172-31-7-44.ap-southeast-1.compute.internal
ip-172-31-1-207.ap-southeast-1.compute.internal
ip-172-31-7-66.ap-southeast-1.compute.internal
ip-172-31-8-11.ap-southeast-1.compute.internal
ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose-generated.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ fold -w 8
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
+ TABLE_PREFIX=AMmI17yD
+ TABLE_PREFIX=AMmI17yD-
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=AMmI17yD- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init create cayon
2023/04/05 13:53:32 [INFO] log mode: READLOG
CastInfo status: CREATING
CastInfo status: CREATING
MovieReview status: CREATING
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=AMmI17yD- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init populate cayon /tmp/compressed.json
2023/04/05 13:53:42 [INFO] log mode: READLOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-1-207.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-11.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-145.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-15-247.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- TABLE_PREFIX=AMmI17yD- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_unique-id-service
Creating service boki_zookeeper
Creating service boki_boki-storage
Creating service boki_compose-review-service
Creating service boki_plot-service
Creating service boki_rating-service
Creating service boki_text-service
Creating service boki_boki-sequencer
Creating service boki_user-review-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
Creating service boki_page-service
Creating service boki_boki-controller
Creating service boki_boki-engine
Creating service boki_cast-info-service
Creating service boki_movie-id-service
Creating service boki_movie-info-service
Creating service boki_boki-gateway
Creating service boki_frontend
Creating service boki_movie-review-service
Creating service boki_review-storage-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-113.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=152a7c4f0fdc7da8ec2189e1dd84d8b1d695daed33be8f42aea877c97884adef
+ echo 4096
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/152a7c4f0fdc7da8ec2189e1dd84d8b1d695daed33be8f42aea877c97884adef/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-59.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8d796f71b13ce24d6e49e2b84b3ac2997f34afc89e4df554fc0f32d032a347a6
+ echo 4096
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8d796f71b13ce24d6e49e2b84b3ac2997f34afc89e4df554fc0f32d032a347a6/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-83.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=60453db67b0059b007db6843cf581c6747d3b045033d891f2cd830add87b63a8
+ echo 4096
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/60453db67b0059b007db6843cf581c6747d3b045033d891f2cd830add87b63a8/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-10.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=18e96634567104c1e3938a4dd8a2f5c118a6dff52dd3e1dcee585b0b280a6df1
+ echo 4096
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/18e96634567104c1e3938a4dd8a2f5c118a6dff52dd3e1dcee585b0b280a6df1/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-8-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=833ad36046751c224fe7870c7661c661d0845d11a85298128559d35f158553a2
+ echo 4096
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/833ad36046751c224fe7870c7661c661d0845d11a85298128559d35f158553a2/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-199.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=904e37791f3b21ce26c9f699865c553d396014cca0875bfd1ad580e47cee4e30
+ echo 4096
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/904e37791f3b21ce26c9f699865c553d396014cca0875bfd1ad580e47cee4e30/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8118df3e4fd40b95ed0b98eb1a314d58c70cd8de1ac61e0fa619c4909e17e7e7
+ echo 4096
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8118df3e4fd40b95ed0b98eb1a314d58c70cd8de1ac61e0fa619c4909e17e7e7/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-5-66.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=dfec914c8172f1817bf7fe63cf82086ec34d9268e2d816fe4446d47df4f359ed
+ echo 4096
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/dfec914c8172f1817bf7fe63cf82086ec34d9268e2d816fe4446d47df4f359ed/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS500
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS500
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/media/workload.lua ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 500
+ sleep 10
+ scp -q ip-172-31-7-44.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS500
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS500/async_results
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=AMmI17yD- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init clean cayon
2023/04/05 14:00:48 [INFO] log mode: READLOG
finished QPS500
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS550
+ QPS=550
+ LOGMODE=read
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ MANAGER_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ CLIENT_HOST=ip-172-31-13-226.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ ALL_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal
ip-172-31-7-44.ap-southeast-1.compute.internal
ip-172-31-1-207.ap-southeast-1.compute.internal
ip-172-31-7-66.ap-southeast-1.compute.internal
ip-172-31-8-11.ap-southeast-1.compute.internal
ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose-generated.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ head -n 1
++ fold -w 8
+ TABLE_PREFIX=ByKPEXVM
+ TABLE_PREFIX=ByKPEXVM-
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=ByKPEXVM- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init create cayon
2023/04/05 14:01:36 [INFO] log mode: READLOG
CastInfo status: CREATING
CastInfo status: CREATING
Plot status: CREATING
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=ByKPEXVM- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init populate cayon /tmp/compressed.json
2023/04/05 14:01:46 [INFO] log mode: READLOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-1-207.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-11.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-145.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-15-247.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- TABLE_PREFIX=ByKPEXVM- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_rating-service
Creating service boki_zookeeper
Creating service boki_cast-info-service
Creating service boki_compose-review-service
Creating service boki_movie-id-service
Creating service boki_review-storage-service
Creating service boki_zookeeper-setup
Creating service boki_boki-controller
Creating service boki_boki-sequencer
Creating service boki_frontend
Creating service boki_page-service
Creating service boki_text-service
Creating service boki_user-review-service
Creating service boki_boki-engine
Creating service boki_boki-gateway
Creating service boki_movie-review-service
Creating service boki_plot-service
Creating service boki_unique-id-service
Creating service boki_user-service
Creating service boki_boki-storage
Creating service boki_movie-info-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-113.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=c67258970c822fe2ee945caa4fa34f6b220a7794db9b0505ac6f651491879493
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/c67258970c822fe2ee945caa4fa34f6b220a7794db9b0505ac6f651491879493/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-59.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=9fce06e9912a3a83010a97c04e6ecd0996469a3e02890c2528e608cee5d48d77
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/9fce06e9912a3a83010a97c04e6ecd0996469a3e02890c2528e608cee5d48d77/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-83.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b843c8998896189409f91a0fa33a907235ffd26e4d62cdaafc256434f8be2653
+ echo 4096
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b843c8998896189409f91a0fa33a907235ffd26e4d62cdaafc256434f8be2653/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-10.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=b86a099ca0aec82d2b2460dc388da9883c0c01faf345ac90b5956755102b6a0e
+ echo 4096
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/b86a099ca0aec82d2b2460dc388da9883c0c01faf345ac90b5956755102b6a0e/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-8-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=9e54427eb1ed994ebcc7880ff10fce3e7c1aebfa85cca1027f77175a82076250
+ echo 4096
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/9e54427eb1ed994ebcc7880ff10fce3e7c1aebfa85cca1027f77175a82076250/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-199.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=d977163e294d9900aa85edd9347fbad7e5dc6a7cc63e2c7acf435e7c7ac78ad0
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/d977163e294d9900aa85edd9347fbad7e5dc6a7cc63e2c7acf435e7c7ac78ad0/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=38c488261ed0532be35e07b44ffde91c1de6851ce9d4097a05d979140391d5c9
+ echo 4096
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/38c488261ed0532be35e07b44ffde91c1de6851ce9d4097a05d979140391d5c9/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-5-66.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=68b9d8b37b2abac5b3a5d3b15036f83b58658174f608a37f35e54233b8375b43
+ echo 4096
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/68b9d8b37b2abac5b3a5d3b15036f83b58658174f608a37f35e54233b8375b43/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS550
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS550
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/media/workload.lua ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 550
+ sleep 10
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 550
+ sleep 10
+ scp -q ip-172-31-7-44.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS550
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS550/async_results
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=ByKPEXVM- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init clean cayon
2023/04/05 14:08:52 [INFO] log mode: READLOG
finished QPS550
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS600
+ QPS=600
+ LOGMODE=read
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ MANAGER_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ CLIENT_HOST=ip-172-31-13-226.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ ALL_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal
ip-172-31-7-44.ap-southeast-1.compute.internal
ip-172-31-1-207.ap-southeast-1.compute.internal
ip-172-31-7-66.ap-southeast-1.compute.internal
ip-172-31-8-11.ap-southeast-1.compute.internal
ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose-generated.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
++ fold -w 8
+ TABLE_PREFIX=iwXc6koh
+ TABLE_PREFIX=iwXc6koh-
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=iwXc6koh- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init create cayon
2023/04/05 14:09:39 [INFO] log mode: READLOG
CastInfo status: CREATING
CastInfo status: CREATING
MovieId status: CREATING
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=iwXc6koh- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init populate cayon /tmp/compressed.json
2023/04/05 14:09:49 [INFO] log mode: READLOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-1-207.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-11.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-145.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-15-247.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- TABLE_PREFIX=iwXc6koh- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-engine
Creating service boki_movie-info-service
Creating service boki_rating-service
Creating service boki_text-service
Creating service boki_zookeeper-setup
Creating service boki_boki-controller
Creating service boki_movie-id-service
Creating service boki_plot-service
Creating service boki_user-review-service
Creating service boki_boki-gateway
Creating service boki_boki-storage
Creating service boki_cast-info-service
Creating service boki_compose-review-service
Creating service boki_frontend
Creating service boki_user-service
Creating service boki_zookeeper
Creating service boki_boki-sequencer
Creating service boki_movie-review-service
Creating service boki_page-service
Creating service boki_review-storage-service
Creating service boki_unique-id-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-113.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=81d3dd4ccbfabeabc02b28d8987b6e0365ada625f7913aa5aa0d65601e077062
+ echo 4096
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/81d3dd4ccbfabeabc02b28d8987b6e0365ada625f7913aa5aa0d65601e077062/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-59.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8cc6d2b128ec57a734c1544ee1635e5b05dee22886f57e796bcef450f2184d68
+ echo 4096
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8cc6d2b128ec57a734c1544ee1635e5b05dee22886f57e796bcef450f2184d68/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-83.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=19e61f8d6b44c99ffd4ab6a0710dcfe471bd611e10469332707a09eb7982c8d4
+ echo 4096
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/19e61f8d6b44c99ffd4ab6a0710dcfe471bd611e10469332707a09eb7982c8d4/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-10.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=50419d1c975debe2710c36fe62048e2d057800c0e6d0226322c081adb2688cbf
+ echo 4096
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/50419d1c975debe2710c36fe62048e2d057800c0e6d0226322c081adb2688cbf/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-8-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=43b37330eb604f26b6b089862bdeddea3d1506c119cda801ecd910e504b53643
+ echo 4096
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/43b37330eb604f26b6b089862bdeddea3d1506c119cda801ecd910e504b53643/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-199.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=2cf6699f831b7f758674e1c6b41d664f85722cd1feedfd4818b0ff82f4739914
+ echo 4096
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/2cf6699f831b7f758674e1c6b41d664f85722cd1feedfd4818b0ff82f4739914/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=af4aef044eae45cf56232878f7346a81f015208fc01bf772b902f6505dcc8dc0
+ echo 4096
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/af4aef044eae45cf56232878f7346a81f015208fc01bf772b902f6505dcc8dc0/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-5-66.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=6d6326dade49079a9c0d928b576e7b67d58125bae606377d475e1274d5d2f316
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/6d6326dade49079a9c0d928b576e7b67d58125bae606377d475e1274d5d2f316/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS600
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS600
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/media/workload.lua ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 600
+ sleep 10
+ scp -q ip-172-31-7-44.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS600
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS600/async_results
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=iwXc6koh- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init clean cayon
2023/04/05 14:16:56 [INFO] log mode: READLOG
finished QPS600
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS650
+ QPS=650
+ LOGMODE=read
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ MANAGER_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ CLIENT_HOST=ip-172-31-13-226.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ ALL_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal
ip-172-31-7-44.ap-southeast-1.compute.internal
ip-172-31-1-207.ap-southeast-1.compute.internal
ip-172-31-7-66.ap-southeast-1.compute.internal
ip-172-31-8-11.ap-southeast-1.compute.internal
ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose-generated.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ head -n 1
++ fold -w 8
++ head -c 64 /dev/urandom
++ tr -dc a-zA-Z0-9
+ TABLE_PREFIX=Whnz1XQG
+ TABLE_PREFIX=Whnz1XQG-
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=Whnz1XQG- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init create cayon
2023/04/05 14:17:44 [INFO] log mode: READLOG
CastInfo status: CREATING
CastInfo status: CREATING
MovieInfo status: CREATING
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=Whnz1XQG- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init populate cayon /tmp/compressed.json
2023/04/05 14:17:53 [INFO] log mode: READLOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-1-207.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-11.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-145.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-15-247.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- TABLE_PREFIX=Whnz1XQG- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_movie-id-service
Creating service boki_movie-review-service
Creating service boki_plot-service
Creating service boki_unique-id-service
Creating service boki_boki-engine
Creating service boki_frontend
Creating service boki_zookeeper
Creating service boki_page-service
Creating service boki_rating-service
Creating service boki_user-review-service
Creating service boki_boki-controller
Creating service boki_boki-gateway
Creating service boki_boki-sequencer
Creating service boki_compose-review-service
Creating service boki_movie-info-service
Creating service boki_user-service
Creating service boki_zookeeper-setup
Creating service boki_boki-storage
Creating service boki_cast-info-service
Creating service boki_review-storage-service
Creating service boki_text-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-113.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=cb15d6e3ec5399780a581e27e085a4f4af46bdefab45cb7b2850baf18afb8aa0
+ echo 4096
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/cb15d6e3ec5399780a581e27e085a4f4af46bdefab45cb7b2850baf18afb8aa0/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-59.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4f9b47452118efd0634e4b04123a3435b3eb55141fa6aaae484241df5c6555ce
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4f9b47452118efd0634e4b04123a3435b3eb55141fa6aaae484241df5c6555ce/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-83.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=caed094349c42a422a2cfd761be327811f871db5397cf1ae327d087f0cb90c5f
+ echo 4096
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/caed094349c42a422a2cfd761be327811f871db5397cf1ae327d087f0cb90c5f/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-10.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=a755337733b4847d3083e3b2c1468e72c234a8371a2201c460544f2e5e9574cb
+ echo 4096
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/a755337733b4847d3083e3b2c1468e72c234a8371a2201c460544f2e5e9574cb/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-8-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=da8933a8248bebf8cb3623eb4ee74de67c5d23435f7a8f50ea0250b603bbe4bd
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/da8933a8248bebf8cb3623eb4ee74de67c5d23435f7a8f50ea0250b603bbe4bd/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-199.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=12b88a6f7b6033cbfe5ad5b741d7aa635dfa7d2f3b4c7d64d0fef81d0b304e31
+ echo 4096
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/12b88a6f7b6033cbfe5ad5b741d7aa635dfa7d2f3b4c7d64d0fef81d0b304e31/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=3a9a5681044ab175bb9c137cec4fe32a85b4bbfab8df105d9855d35adb94b976
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/3a9a5681044ab175bb9c137cec4fe32a85b4bbfab8df105d9855d35adb94b976/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-5-66.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=1f4737b4e8462edf3e673dd2fd7ac95ccebfbe20edf27bd33692a09291a16332
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/1f4737b4e8462edf3e673dd2fd7ac95ccebfbe20edf27bd33692a09291a16332/cpu.shares
+ echo 4096
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS650
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS650
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/media/workload.lua ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 650
+ sleep 10
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 650
+ sleep 10
+ scp -q ip-172-31-7-44.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS650
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS650/async_results
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=Whnz1XQG- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init clean cayon
2023/04/05 14:25:00 [INFO] log mode: READLOG
finished QPS650
+++ dirname /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_once.sh
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ BASE_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
++ realpath /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/../../..
+ ROOT_DIR=/home/ubuntu/boki-benchmarks
+ BENCH_IMAGE=shengqipku/boki-beldibench:workflow
+ STACK=boki
+ AWS_REGION=ap-southeast-1
+ EXP_DIR=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS700
+ QPS=700
+ LOGMODE=read
+ HELPER_SCRIPT=/home/ubuntu/boki-benchmarks/scripts/exp_helper
+ WRK_DIR=/usr/local/bin
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-docker-manager-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ MANAGER_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-client-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ CLIENT_HOST=ip-172-31-13-226.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-service-host --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service=boki-gateway
+ ENTRY_HOST=ip-172-31-7-44.ap-southeast-1.compute.internal
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-all-server-hosts --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ ALL_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal
ip-172-31-7-44.ap-southeast-1.compute.internal
ip-172-31-1-207.ap-southeast-1.compute.internal
ip-172-31-7-66.ap-southeast-1.compute.internal
ip-172-31-8-11.ap-southeast-1.compute.internal
ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ /home/ubuntu/boki-benchmarks/scripts/exp_helper generate-docker-compose --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/docker-compose-generated.yml 'ip-172-31-7-44.ap-southeast-1.compute.internal:~'
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- docker stack rm boki
Removing service boki_boki-controller
Removing service boki_boki-engine
Removing service boki_boki-gateway
Removing service boki_boki-sequencer
Removing service boki_boki-storage
Removing service boki_cast-info-service
Removing service boki_compose-review-service
Removing service boki_frontend
Removing service boki_movie-id-service
Removing service boki_movie-info-service
Removing service boki_movie-review-service
Removing service boki_page-service
Removing service boki_plot-service
Removing service boki_rating-service
Removing service boki_review-storage-service
Removing service boki_text-service
Removing service boki_unique-id-service
Removing service boki_user-review-service
Removing service boki_user-service
Removing service boki_zookeeper
Removing service boki_zookeeper-setup
Removing network boki_default
+ sleep 40
++ tr -dc a-zA-Z0-9
++ head -c 64 /dev/urandom
++ fold -w 8
++ head -n 1
+ TABLE_PREFIX=KyrYCb5H
+ TABLE_PREFIX=KyrYCb5H-
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker pull shengqipku/boki-beldibench:workflow
workflow: Pulling from shengqipku/boki-beldibench
Digest: sha256:c57fde79b16d5aa3df3eca51642445e387b80e34a3d65a43ecc93e851e968264
Status: Image is up to date for shengqipku/boki-beldibench:workflow
docker.io/shengqipku/boki-beldibench:workflow
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- docker run -v /tmp:/tmp shengqipku/boki-beldibench:workflow cp -r /optimal-bin/media /tmp/
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/boki/internal/media/data/compressed.json ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=KyrYCb5H- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init create cayon
2023/04/05 14:25:48 [INFO] log mode: READLOG
CastInfo status: CREATING
CastInfo status: CREATING
CastInfo status: CREATING
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=KyrYCb5H- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init populate cayon /tmp/compressed.json
2023/04/05 14:25:58 [INFO] log mode: READLOG
+ scp -q /home/ubuntu/boki-benchmarks/scripts/zk_setup.sh ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/zk_setup.sh
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/store
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-44.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-1-207.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-7-66.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-8-11.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-2-39.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-0-145.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
+ for host in $ALL_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/nightcore_config.json ip-172-31-15-247.ap-southeast-1.compute.internal:/tmp/nightcore_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=engine_node
+ ALL_ENGINE_HOSTS='ip-172-31-2-113.ap-southeast-1.compute.internal
ip-172-31-3-59.ap-southeast-1.compute.internal
ip-172-31-2-83.ap-southeast-1.compute.internal
ip-172-31-3-10.ap-southeast-1.compute.internal
ip-172-31-8-85.ap-southeast-1.compute.internal
ip-172-31-0-199.ap-southeast-1.compute.internal
ip-172-31-0-13.ap-southeast-1.compute.internal
ip-172-31-5-66.ap-southeast-1.compute.internal'
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-113.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-59.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-2-83.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-3-10.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-8-85.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-199.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-0-13.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
+ for HOST in $ALL_ENGINE_HOSTS
+ scp -q /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/run_launcher ip-172-31-5-66.ap-southeast-1.compute.internal:/tmp/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/inmem/boki/output /mnt/inmem/boki/ipc
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/run_launcher /mnt/inmem/boki/run_launcher
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo cp /tmp/nightcore_config.json /mnt/inmem/boki/func_config.json
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-machine-with-label --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --machine-label=storage_node
+ ALL_STORAGE_HOSTS='ip-172-31-2-39.ap-southeast-1.compute.internal
ip-172-31-0-145.ap-southeast-1.compute.internal
ip-172-31-15-247.ap-southeast-1.compute.internal'
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-2-39.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-0-145.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ for HOST in $ALL_STORAGE_HOSTS
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo rm -rf /mnt/storage/logdata
+ ssh -q ip-172-31-15-247.ap-southeast-1.compute.internal -- sudo mkdir -p /mnt/storage/logdata
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- TABLE_PREFIX=KyrYCb5H- docker stack deploy -c /home/ubuntu/docker-compose-generated.yml -c /home/ubuntu/docker-compose.yml boki
Ignoring unsupported options: restart

Creating network boki_default
Creating service boki_boki-gateway
Creating service boki_cast-info-service
Creating service boki_movie-info-service
Creating service boki_review-storage-service
Creating service boki_zookeeper-setup
Creating service boki_boki-controller
Creating service boki_boki-engine
Creating service boki_boki-storage
Creating service boki_compose-review-service
Creating service boki_plot-service
Creating service boki_rating-service
Creating service boki_zookeeper
Creating service boki_boki-sequencer
Creating service boki_page-service
Creating service boki_text-service
Creating service boki_unique-id-service
Creating service boki_user-review-service
Creating service boki_user-service
Creating service boki_frontend
Creating service boki_movie-id-service
Creating service boki_movie-review-service
+ sleep 80
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-113.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=bf926811b4886ffde8d6d109f50217ee96b08bd13dd9f8a71077cb9683286167
+ ssh -q ip-172-31-2-113.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/bf926811b4886ffde8d6d109f50217ee96b08bd13dd9f8a71077cb9683286167/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-59.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=615073ea774105f252539f60d991beb9b5014193304104c0d6ba097552646f8c
+ echo 4096
+ ssh -q ip-172-31-3-59.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/615073ea774105f252539f60d991beb9b5014193304104c0d6ba097552646f8c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-2-83.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=cba3d732a0b238e23502047a1eb38ff3351114294cb72fe5f543ada5a89424e0
+ ssh -q ip-172-31-2-83.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/cba3d732a0b238e23502047a1eb38ff3351114294cb72fe5f543ada5a89424e0/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-3-10.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=10204be24d1e938ab3b4ffb5d5b72f3c83d87f7efdf117df91525b0628153673
+ echo 4096
+ ssh -q ip-172-31-3-10.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/10204be24d1e938ab3b4ffb5d5b72f3c83d87f7efdf117df91525b0628153673/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-8-85.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=aed1efeda941f0d5d841527d05808ef4ba258fbe1761f55918886ce744a6ad6e
+ ssh -q ip-172-31-8-85.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/aed1efeda941f0d5d841527d05808ef4ba258fbe1761f55918886ce744a6ad6e/cpu.shares
+ echo 4096
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-199.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=aca413b88362b4a2ab753d4ed319a4e56ce9fa9dc4244a0e313b67385417e927
+ echo 4096
+ ssh -q ip-172-31-0-199.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/aca413b88362b4a2ab753d4ed319a4e56ce9fa9dc4244a0e313b67385417e927/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-0-13.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=8828d0171ec5fa30a26660674f6115f3910632b1f2e9928cee64f47b8cab976c
+ echo 4096
+ ssh -q ip-172-31-0-13.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/8828d0171ec5fa30a26660674f6115f3910632b1f2e9928cee64f47b8cab976c/cpu.shares
4096
+ for HOST in $ALL_ENGINE_HOSTS
++ /home/ubuntu/boki-benchmarks/scripts/exp_helper get-container-id --base-dir=/home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie --service boki-engine --machine-host ip-172-31-5-66.ap-southeast-1.compute.internal
+ ENGINE_CONTAINER_ID=4e95e148cd3f71230e8a31f6a8329f32fe6a63d0b0abd92a9d39d36ad55c0851
+ echo 4096
+ ssh -q ip-172-31-5-66.ap-southeast-1.compute.internal -- sudo tee /sys/fs/cgroup/cpu,cpuacct/docker/4e95e148cd3f71230e8a31f6a8329f32fe6a63d0b0abd92a9d39d36ad55c0851/cpu.shares
4096
+ sleep 10
+ rm -rf /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS700
+ mkdir -p /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS700
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- cat /proc/cmdline
+ ssh -q ip-172-31-7-44.ap-southeast-1.compute.internal -- uname -a
+ scp -q /home/ubuntu/boki-benchmarks/workloads/workflow/optimal/benchmark/media/workload.lua ip-172-31-13-226.ap-southeast-1.compute.internal:/tmp
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 30 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- /usr/local/bin/wrk -t 2 -c 2 -d 150 -L -U -s /tmp/workload.lua http://ip-172-31-7-44.ap-southeast-1.compute.internal:8080 -R 700
+ sleep 10
+ scp -q ip-172-31-7-44.ap-southeast-1.compute.internal:/mnt/inmem/store/async_results /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS700
+ /home/ubuntu/boki-benchmarks/scripts/compute_latency.py --async-result-file /home/ubuntu/boki-benchmarks/experiments/workflow/opt-movie/results/QPS700/async_results
+ ssh -q ip-172-31-13-226.ap-southeast-1.compute.internal -- TABLE_PREFIX=KyrYCb5H- AWS_REGION=ap-southeast-1 LoggingMode=read /tmp/media/init clean cayon
2023/04/05 14:33:05 [INFO] log mode: READLOG
finished QPS700
