apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: login
spec:
  selector:
    matchLabels:
      app: login
  template:
    metadata:
      labels:
        app: login
    spec:
      containers:
        - name: login
          image: emptyredbox/halfmoon-bench:small-v0
          command: ["/tmp/boki/run_launcher", "/optimal-bin/retwis/login", "1"]
          volumeMounts:
            - name: inmem-boki-volume
              mountPath: /tmp/boki
            - name: credentials-volume
              mountPath: /root/.aws
          env:
            - name: FAAS_GO_MAX_PROC_FACTOR
              value: "4"
            - name: GOGC
              value: "1000"
            - name: TABLE_PREFIX
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: TABLE_PREFIX
            - name: LoggingMode
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: LoggingMode
      volumes:
        - name: inmem-boki-volume
          hostPath:
            path: /mnt/inmem/boki
        - name: credentials-volume
          hostPath:
            path: /mnt/inmem/.aws
      nodeSelector:
        node-restriction.kubernetes.io/placement_label: engine_node
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: profile
spec:
  selector:
    matchLabels:
      app: profile
  template:
    metadata:
      labels:
        app: profile
    spec:
      containers:
        - name: profile
          image: emptyredbox/halfmoon-bench:small-v0
          command: ["/tmp/boki/run_launcher", "/optimal-bin/retwis/profile", "2"]
          volumeMounts:
            - name: inmem-boki-volume
              mountPath: /tmp/boki
            - name: credentials-volume
              mountPath: /root/.aws
          env:
            - name: FAAS_GO_MAX_PROC_FACTOR
              value: "4"
            - name: GOGC
              value: "1000"
            - name: TABLE_PREFIX
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: TABLE_PREFIX
            - name: LoggingMode
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: LoggingMode
      volumes:
        - name: inmem-boki-volume
          hostPath:
            path: /mnt/inmem/boki
        - name: credentials-volume
          hostPath:
            path: /mnt/inmem/.aws
      nodeSelector:
        node-restriction.kubernetes.io/placement_label: engine_node
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: timeline
spec:
  selector:
    matchLabels:
      app: timeline
  template:
    metadata:
      labels:
        app: timeline
    spec:
      containers:
        - name: timeline
          image: emptyredbox/halfmoon-bench:small-v0
          command: ["/tmp/boki/run_launcher", "/optimal-bin/retwis/timeline", "3"]
          volumeMounts:
            - name: inmem-boki-volume
              mountPath: /tmp/boki
            - name: credentials-volume
              mountPath: /root/.aws
          env:
            - name: FAAS_GO_MAX_PROC_FACTOR
              value: "4"
            - name: GOGC
              value: "1000"
            - name: MAX_RETURN_POSTS
              value: "5"
            - name: TABLE_PREFIX
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: TABLE_PREFIX
            - name: LoggingMode
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: LoggingMode
      volumes:
        - name: inmem-boki-volume
          hostPath:
            path: /mnt/inmem/boki
        - name: credentials-volume
          hostPath:
            path: /mnt/inmem/.aws
      nodeSelector:
        node-restriction.kubernetes.io/placement_label: engine_node
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: post
spec:
  selector:
    matchLabels:
      app: post
  template:
    metadata:
      labels:
        app: post
    spec:
      containers:
        - name: post
          image: emptyredbox/halfmoon-bench:small-v0
          command: ["/tmp/boki/run_launcher", "/optimal-bin/retwis/post", "4"]
          volumeMounts:
            - name: inmem-boki-volume
              mountPath: /tmp/boki
            - name: credentials-volume
              mountPath: /root/.aws
          env:
            - name: FAAS_GO_MAX_PROC_FACTOR
              value: "4"
            - name: GOGC
              value: "1000"
            - name: TABLE_PREFIX
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: TABLE_PREFIX
            - name: LoggingMode
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: LoggingMode
      volumes:
        - name: inmem-boki-volume
          hostPath:
            path: /mnt/inmem/boki
        - name: credentials-volume
          hostPath:
            path: /mnt/inmem/.aws
      nodeSelector:
        node-restriction.kubernetes.io/placement_label: engine_node
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: publish
spec:
  selector:
    matchLabels:
      app: publish
  template:
    metadata:
      labels:
        app: publish
    spec:
      containers:
        - name: publish
          image: emptyredbox/halfmoon-bench:small-v0
          command: ["/tmp/boki/run_launcher", "/optimal-bin/retwis/publish", "5"]
          volumeMounts:
            - name: inmem-boki-volume
              mountPath: /tmp/boki
            - name: credentials-volume
              mountPath: /root/.aws
          env:
            - name: FAAS_GO_MAX_PROC_FACTOR
              value: "4"
            - name: GOGC
              value: "1000"
            - name: TABLE_PREFIX
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: TABLE_PREFIX
            - name: LoggingMode
              valueFrom:
                configMapKeyRef:
                  name: env-config
                  key: LoggingMode
      volumes:
        - name: inmem-boki-volume
          hostPath:
            path: /mnt/inmem/boki
        - name: credentials-volume
          hostPath:
            path: /mnt/inmem/.aws
      nodeSelector:
        node-restriction.kubernetes.io/placement_label: engine_node
